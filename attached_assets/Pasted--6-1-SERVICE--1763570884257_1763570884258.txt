â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ—ĞĞ”ĞĞ§Ğ 6.1: Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ Ğ‘ĞĞ—ĞĞ’Ğ«Ğ™ SERVICE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ Ğ¤ĞĞ™Ğ›: server/services/product-catalog.service.ts

Ğ¡ĞĞ”Ğ•Ğ Ğ–Ğ˜ĞœĞĞ•:

import { productCatalogRepository } from '../repositories/product-catalog.repository';
import { productPriceHistoryRepository } from '../repositories/product-price-history.repository';

// ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
export function normalizeName(name: string): string {
  return name
    .toLowerCase()
    .trim()
    .replace(/[^Ğ°-Ña-z0-9\s]/g, '') // ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ ÑĞ¿ĞµÑ†ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
    .replace(/\s+/g, ' '); // ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹
}

// Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ Ğ±Ñ€ĞµĞ½Ğ´ Ğ¸Ğ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)
export function extractBrand(name: string): string | null {
  // Ğ˜Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ±Ñ€ĞµĞ½Ğ´Ñ‹ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ)
  const brands = [
    'barilla', 'Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ĞºĞ²Ğ°ÑˆĞ¸Ğ½Ğ¾', 'nestle', 'coca-cola', 
    'pepsi', 'danone', 'Ğ¼Ğ°ĞºÑ„Ğ°', 'heinz', 'knorr'
  ];
  
  const normalized = name.toLowerCase();
  
  for (const brand of brands) {
    if (normalized.includes(brand)) {
      return brand.charAt(0).toUpperCase() + brand.slice(1);
    }
  }
  
  return null;
}

// Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ Ğ²ĞµÑ/Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ¸Ğ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ
export function extractWeight(name: string): string | null {
  // ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹: 500Ğ³, 1ĞºĞ³, 1Ğ», 500Ğ¼Ğ»
  const weightPattern = /(\d+(?:\.\d+)?)\s*(Ğ³|ĞºĞ³|Ğ»|Ğ¼Ğ»|ÑˆÑ‚)/i;
  const match = name.match(weightPattern);
  
  if (match) {
    return match[0]; // "500Ğ³"
  }
  
  return null;
}

// ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğµ
export async function findOrCreateProduct(params: {
  name: string;
  userId: number;
  category?: string;
}): Promise<number> {
  const normalizedName = normalizeName(params.name);
  
  // ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹
  let product = await productCatalogRepository.findByNormalizedName(
    normalizedName, 
    params.userId
  );
  
  if (product) {
    return product.id;
  }
  
  // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹
  const brand = extractBrand(params.name);
  const weight = extractWeight(params.name);
  
  product = await productCatalogRepository.create({
    userId: params.userId,
    name: params.name,
    normalizedName,
    brand,
    weight,
    category: params.category,
    purchaseCount: 0
  });
  
  return product.id;
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ»ÑƒÑ‡ÑˆÑƒÑ Ñ†ĞµĞ½Ñƒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
export async function updateBestPrice(productId: number): Promise<void> {
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ñ†ĞµĞ½Ñ‹
  const prices = await productPriceHistoryRepository.findByProduct(productId);
  
  if (prices.length === 0) return;
  
  // ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ»ÑƒÑ‡ÑˆÑƒÑ (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ)
  const best = prices.reduce((min, p) => 
    parseFloat(p.price) < parseFloat(min.price) ? p : min
  );
  
  // Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑÑ€ĞµĞ´Ğ½ÑÑ
  const sum = prices.reduce((acc, p) => acc + parseFloat(p.price), 0);
  const avg = sum / prices.length;
  
  // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€
  await productCatalogRepository.update(productId, {
    bestPrice: best.price,
    bestStore: best.storeName,
    averagePrice: avg.toFixed(2)
  });
}

Ğ¡Ğ¢Ğ ĞĞš: ~95 âœ…
ĞĞ¢Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ•ĞĞĞĞ¡Ğ¢Ğ¬: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ğ¼Ğ¸ âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞĞ–Ğ˜Ğ”ĞĞ•ĞœĞ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:
âœ… Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹
âœ… Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ±Ñ€ĞµĞ½Ğ´Ğ° Ğ¸ Ğ²ĞµÑĞ°
âœ… ĞŸĞ¾Ğ¸ÑĞº/ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°
âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ñ†ĞµĞ½Ñ‹

ğŸ“Š Ğ¨ĞĞ“ 7: PRODUCT CATALOG SERVICE - Ğ§ĞĞ¡Ğ¢Ğ¬ 2 (20 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ—ĞĞ”ĞĞ§Ğ 7.1: Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ ĞšĞĞ¢Ğ•Ğ“ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ Ğ’ Ğ¤ĞĞ™Ğ›: server/services/product-catalog.service.ts

// AI ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ Ğ±ĞµĞ· AI)
export async function categorizeProduct(
  name: string,
  anthropicApiKey?: string
): Promise<string> {
  // ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ rule-based ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ±ĞµĞ· AI)
  const categoryRules: Record<string, string[]> = {
    'ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ': [
      'Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹', 'Ñ…Ğ»ĞµĞ±', 'Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾', 'ÑÑ‹Ñ€', 'Ğ¼Ğ°ÑĞ»Ğ¾', 
      'Ğ¼ÑÑĞ¾', 'Ñ€Ñ‹Ğ±Ğ°', 'Ğ¾Ğ²Ğ¾Ñ‰Ğ¸', 'Ñ„Ñ€ÑƒĞºÑ‚Ñ‹', 'ĞºÑ€ÑƒĞ¿Ğ°'
    ],
    'ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸': [
      'Ğ²Ğ¾Ğ´Ğ°', 'ÑĞ¾Ğº', 'Ñ‡Ğ°Ğ¹', 'ĞºĞ¾Ñ„Ğµ', 'Ğ½Ğ°Ğ¿Ğ¸Ñ‚Ğ¾Ğº', 
      'coca', 'pepsi', 'sprite'
    ],
    'Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ°Ñ Ñ…Ğ¸Ğ¼Ğ¸Ñ': [
      'Ğ¿Ğ¾Ñ€Ğ¾ÑˆĞ¾Ğº', 'Ğ¼Ñ‹Ğ»Ğ¾', 'ÑˆĞ°Ğ¼Ğ¿ÑƒĞ½ÑŒ', 'Ğ³ĞµĞ»ÑŒ', 
      'ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ¾', 'Ñ‡Ğ¸ÑÑ‚ÑÑ‰ĞµĞµ'
    ],
    'ĞšĞ¾ÑĞ¼ĞµÑ‚Ğ¸ĞºĞ°': [
      'ĞºÑ€ĞµĞ¼', 'Ğ»Ğ¾ÑÑŒĞ¾Ğ½', 'Ğ¼Ğ°ÑĞºĞ°', 'Ğ¿Ğ¾Ğ¼Ğ°Ğ´Ğ°', 'Ñ‚ÑƒÑˆÑŒ'
    ]
  };
  
  const normalized = name.toLowerCase();
  
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğ¼ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼
  for (const [category, keywords] of Object.entries(categoryRules)) {
    for (const keyword of keywords) {
      if (normalized.includes(keyword)) {
        return category;
      }
    }
  }
  
  // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸ - Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ "Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ"
  return 'Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ';
  
  // TODO: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ AI ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ¶Ğµ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  // if (anthropicApiKey) {
  //   return await categorizeWithAI(name, anthropicApiKey);
  // }
}

Ğ”ĞĞ‘ĞĞ’Ğ›Ğ¯Ğ•ĞœĞ«Ğ¥ Ğ¡Ğ¢Ğ ĞĞš: ~40 âœ…
Ğ˜Ğ¢ĞĞ“Ğ Ğ’ Ğ¤ĞĞ™Ğ›Ğ•: ~135 ÑÑ‚Ñ€Ğ¾Ğº âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞĞ–Ğ˜Ğ”ĞĞ•ĞœĞ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:
âœ… Rule-based ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
âœ… ĞœĞ¾Ğ¶Ğ½Ğ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ Ğ½Ğ° AI Ğ¿Ğ¾Ğ·Ğ¶Ğµ
âœ… Fallback Ğ½Ğ° "Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ"