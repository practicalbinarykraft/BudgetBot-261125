üí° –ü–†–ê–í–ò–õ–¨–ù–û–ï –¢–ó (–ü–û–õ–ù–û–ï –ò –ú–û–î–£–õ–¨–ù–û–ï)markdown# ü§ñ –¢–ó: Telegram Bot –¥–ª—è Budget Buddy (Solo –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

## üéØ –ö–û–ù–¶–ï–ü–¶–ò–Ø

**–û–¥–∏–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ BYOK).

**–§—É–Ω–∫—Ü–∏–∏:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ç–µ–∫—Å—Ç–æ–º
2. ‚úÖ Receipt OCR (—Ñ–æ—Ç–æ —á–µ–∫–∞ ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
3. ‚úÖ Voice —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
4. ‚úÖ ML –∞–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
5. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
6. ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Verification code (6 —Ü–∏—Ñ—Ä, 10 –º–∏–Ω—É—Ç)
- –ú–æ–¥—É–ª–∏ <200 —Å—Ç—Ä–æ–∫
- API endpoints

---

## üóÑÔ∏è –®–ê–ì 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (10 –º–∏–Ω—É—Ç)

### –î–æ–±–∞–≤—å —Ç–∞–±–ª–∏—Ü—É –≤ `shared/schema.ts`:
```typescript/**

–ö–æ–¥—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è Telegram
*/
export const telegramVerificationCodes = pgTable("telegram_verification_codes", {
id: serial("id").primaryKey(),
userId: integer("user_id")
.references(() => users.id, { onDelete: "cascade" })
.notNull(),
code: varchar("code", { length: 6 }).notNull().unique(), // 123456
expiresAt: timestamp("expires_at").notNull(),
isUsed: boolean("is_used").default(false),createdAt: timestamp("created_at").defaultNow()
});export type TelegramVerificationCode = typeof telegramVerificationCodes.$inferSelect;

### –û–±–Ω–æ–≤–∏ —Ç–∞–±–ª–∏—Ü—É `users`:
```typescript// –í users —É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
export const users = pgTable("users", {
// ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...telegramId: text("telegram_id").unique(), // Telegram user ID
telegramUsername: text("telegram_username"), // @username// Onboarding:
hasSetupTelegram: boolean("has_setup_telegram").default(false)
});

**–ó–∞–ø—É—Å—Ç–∏:** `npm run db:push`

---

## üîß –®–ê–ì 2: Telegram —Å–µ—Ä–≤–∏—Å (–º–æ–¥—É–ª—å–Ω—ã–π!) (60 –º–∏–Ω—É—Ç)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:server/telegram/
‚îú‚îÄ‚îÄ bot.ts                  (120 —Å—Ç—Ä–æ–∫ - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ commands.ts             (180 —Å—Ç—Ä–æ–∫ - –∫–æ–º–∞–Ω–¥—ã)
‚îú‚îÄ‚îÄ ocr.ts                  (190 —Å—Ç—Ä–æ–∫ - Receipt OCR)
‚îú‚îÄ‚îÄ voice.ts                (180 —Å—Ç—Ä–æ–∫ - –≥–æ–ª–æ—Å)
‚îú‚îÄ‚îÄ parser.ts               (160 —Å—Ç—Ä–æ–∫ - –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞)
‚îú‚îÄ‚îÄ notifications.ts        (150 —Å—Ç—Ä–æ–∫ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
‚îî‚îÄ‚îÄ config.ts               (50 —Å—Ç—Ä–æ–∫ - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)

---

### –§–∞–π–ª 1: `server/telegram/bot.ts` (~120 —Å—Ç—Ä–æ–∫)
```typescriptimport TelegramBot from 'node-telegram-bot-api';
import { handleCommand } from './commands';
import { handlePhoto } from './ocr';
import { handleVoice } from './voice';
import { handleText } from './parser';const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN!;if (!BOT_TOKEN) {
throw new Error('TELEGRAM_BOT_TOKEN is required');
}/**

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
*/
export const bot = new TelegramBot(BOT_TOKEN, {
polling: true // –∏–ª–∏ webhook
});
/**

–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
*/
export function startTelegramBot() {
console.log('ü§ñ Telegram bot started');
// –ö–æ–º–∞–Ω–¥—ã: /start, /verify, /add, /balance
bot.onText(/^/(\w+)(.*)/, async (msg, match) => {
try {
await handleCommand(msg, match);
} catch (error) {
console.error('Command error:', error);
bot.sendMessage(msg.chat.id, '‚ùå Error processing command');
}
});// –§–æ—Ç–æ (Receipt OCR)
bot.on('photo', async (msg) => {
try {
await handlePhoto(msg);
} catch (error) {
console.error('Photo error:', error);
bot.sendMessage(msg.chat.id, '‚ùå Failed to process receipt');
}
});// –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
bot.on('voice', async (msg) => {
try {
await handleVoice(msg);
} catch (error) {
console.error('Voice error:', error);
bot.sendMessage(msg.chat.id, '‚ùå Failed to process voice');
}
});// –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
bot.on('text', async (msg) => {
// –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã
if (msg.text?.startsWith('/')) return;try {
  await handleText(msg);
} catch (error) {
  console.error('Text error:', error);
  bot.sendMessage(msg.chat.id, '‚ùå Failed to parse message');
}
});// Callback queries (inline buttons)
bot.on('callback_query', async (query) => {
try {
await handleCallback(query);
} catch (error) {
console.error('Callback error:', error);
}
});
}/**

–û–±—Ä–∞–±–æ—Ç–∫–∞ inline –∫–Ω–æ–ø–æ–∫
*/
async function handleCallback(query: TelegramBot.CallbackQuery) {
const data = query.data;
const chatId = query.message?.chat.id;
if (!data || !chatId) return;// –§–æ—Ä–º–∞—Ç: action:id:params
const [action, id, ...params] = data.split(':');if (action === 'confirm_transaction') {
// –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
await confirmTransaction(chatId, parseInt(id));
bot.answerCallbackQuery(query.id, { text: '‚úÖ Saved' });
} else if (action === 'cancel') {
bot.deleteMessage(chatId, query.message!.message_id);
bot.answerCallbackQuery(query.id, { text: 'Cancelled' });
}
}

**–†–∞–∑–º–µ—Ä:** ~120 —Å—Ç—Ä–æ–∫ ‚úÖ

---

### –§–∞–π–ª 2: `server/telegram/commands.ts` (~180 —Å—Ç—Ä–æ–∫)
```typescriptimport TelegramBot from 'node-telegram-bot-api';
import { db } from '../db/client';
import { users, transactions } from '@shared/schema';
import { eq } from 'drizzle-orm';
import { bot } from './bot';/**

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
*/
export async function handleCommand(
msg: TelegramBot.Message,
match: RegExpExecArray | null
) {
const command = match?.[1];
const args = match?.[2]?.trim();
const chatId = msg.chat.id;
const telegramId = msg.from?.id.toString();
if (!telegramId) return;switch (command) {
case 'start':
await handleStart(chatId);
break;case 'verify':
  await handleVerify(chatId, telegramId, args);
  break;case 'add':
  await handleAdd(chatId, telegramId, args);
  break;case 'balance':
  await handleBalance(chatId, telegramId);
  break;case 'stats':
  await handleStats(chatId, telegramId);
  break;default:
  bot.sendMessage(chatId, 'Unknown command. Use /start for help.');
}
}/**

/start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
*/
async function handleStart(chatId: number) {
const message = `
üëã Welcome to Budget Buddy Bot!
Commands:
/verify CODE - Link your account
/add 500 coffee - Add transaction
/balance - Show balance
/stats - Show statisticsYou can also:
üì∏ Send receipt photo for OCR
üé§ Send voice message
üí¨ Type: "spent 20 on lunch"
`.trim();bot.sendMessage(chatId, message);
}/**

/verify CODE - —Å–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
*/
async function handleVerify(
chatId: number,
telegramId: string,
code: string | undefined
) {
if (!code || code.length !== 6) {
bot.sendMessage(chatId, '‚ùå Invalid code. Format: /verify 123456');
return;
}
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ —á–µ—Ä–µ–∑ API
try {
const response = await fetch('http://localhost:5000/api/telegram/verify', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ telegramId, code })
});if (response.ok) {
  const data = await response.json();
  bot.sendMessage(chatId, `‚úÖ Account linked! Welcome, ${data.user.name}`);
} else {
  const error = await response.json();
  bot.sendMessage(chatId, `‚ùå ${error.error}`);
}
} catch (error) {
bot.sendMessage(chatId, '‚ùå Verification failed. Try again.');
}
}/**

/add - –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
*/
async function handleAdd(
chatId: number,
telegramId: string,
text: string | undefined
) {
if (!text) {
bot.sendMessage(chatId, '‚ùå Usage: /add 500 coffee');
return;
}
// –ü–æ–ª—É—á–∏—Ç—å user
const user = await getUserByTelegramId(telegramId);
if (!user) {
bot.sendMessage(chatId, '‚ùå Account not linked. Use /verify CODE');
return;
}// –ü–∞—Ä—Å–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
const parsed = parseTransaction(text);
if (!parsed) {
bot.sendMessage(chatId, '‚ùå Could not parse. Try: 500 coffee');
return;
}// –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
await createTransaction(user.id, {
type: 'expense',
amount: parsed.amount,
description: parsed.description,
category: parsed.category,
source: 'telegram'
});bot.sendMessage(chatId, ‚úÖ Added: $${parsed.amount} - ${parsed.description});
}/**

/balance - –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
*/
async function handleBalance(chatId: number, telegramId: string) {
const user = await getUserByTelegramId(telegramId);
if (!user) {
bot.sendMessage(chatId, '‚ùå Account not linked. Use /verify CODE');
return;
}
// –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const txs = await db
.select()
.from(transactions)
.where(eq(transactions.userId, user.id));const income = txs
.filter(t => t.type === 'income')
.reduce((sum, t) => sum + Number(t.amountUsd), 0);const expense = txs
.filter(t => t.type === 'expense')
.reduce((sum, t) => sum + Number(t.amountUsd), 0);const balance = income - expense;const message = `
üí∞ Your BalanceIncome: $${income.toFixed(2)}
Expense: $${expense.toFixed(2)}
Balance: $${balance.toFixed(2)}
`.trim();bot.sendMessage(chatId, message);
}/**

Helper: –ø–æ–ª—É—á–∏—Ç—å user –ø–æ Telegram ID
*/
async function getUserByTelegramId(telegramId: string) {
const [user] = await db
.select()
.from(users)
.where(eq(users.telegramId, telegramId))
.limit(1);
return user || null;
}

**–†–∞–∑–º–µ—Ä:** ~180 —Å—Ç—Ä–æ–∫ ‚úÖ

---

### –§–∞–π–ª 3: `server/telegram/ocr.ts` (~190 —Å—Ç—Ä–æ–∫)
```typescriptimport TelegramBot from 'node-telegram-bot-api';
import Anthropic from '@anthropic-ai/sdk';
import { bot } from './bot';
import { getUserByTelegramId } from './commands';
import { createTransaction } from '../services/transaction.service';const anthropic = new Anthropic({
apiKey: process.env.ANTHROPIC_API_KEY
});/**

–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ —á–µ–∫–∞
*/
export async function handlePhoto(msg: TelegramBot.Message) {
const chatId = msg.chat.id;
const telegramId = msg.from?.id.toString();
if (!telegramId) return;// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å
const user = await getUserByTelegramId(telegramId);
if (!user) {
bot.sendMessage(chatId, '‚ùå Account not linked. Use /verify CODE');
return;
}// –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
bot.sendChatAction(chatId, 'typing');
bot.sendMessage(chatId, 'üì∏ Processing receipt...');try {
// –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
const photo = msg.photo?.[msg.photo.length - 1];
if (!photo) throw new Error('No photo');const file = await bot.getFile(photo.file_id);
const filePath = file.file_path;
if (!filePath) throw new Error('No file path');// –°–∫–∞—á–∞—Ç—å
const fileUrl = `https://api.telegram.org/file/bot${process.env.TELEGRAM_BOT_TOKEN}/${filePath}`;
const response = await fetch(fileUrl);
const buffer = await response.arrayBuffer();
const base64 = Buffer.from(buffer).toString('base64');// OCR —á–µ—Ä–µ–∑ Claude Vision
const result = await recognizeReceipt(base64);// –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç + –∫–Ω–æ–ø–∫–∏
const message = `
üìù Receipt recognized:Amount: $${result.amount}
Merchant: ${result.merchant}
Category: ${result.category || 'Not detected'}
Date: ${result.date}Confirm?
`.trim();bot.sendMessage(chatId, message, {
  reply_markup: {
    inline_keyboard: [[
      { text: '‚úÖ Confirm', callback_data: `confirm_ocr:${JSON.stringify(result)}` },
      { text: '‚ùå Cancel', callback_data: 'cancel' }
    ]]
  }
});} catch (error) {
console.error('OCR error:', error);
bot.sendMessage(chatId, '‚ùå Failed to process receipt. Try again.');
}
}/**

–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —á–µ–∫ —á–µ—Ä–µ–∑ Anthropic Vision
*/
async function recognizeReceipt(base64Image: string) {
const message = await anthropic.messages.create({
model: 'claude-sonnet-4-20250514',
max_tokens: 1024,
messages: [{
role: 'user',
content: [
{
type: 'image',
source: {
type: 'base64',
media_type: 'image/jpeg',
data: base64Image
}
},
{
type: 'text',
text: `Extract receipt information in JSON format:
{
"merchant": "Store name",
"amount": 123.45,
"currency": "USD",
"date": "YYYY-MM-DD",
"category": "Food" or null
}
Only return JSON, no extra text.`
}
]
}]
});const text = message.content[0].type === 'text'
? message.content[0].text
: '';// –ü–∞—Ä—Å–∏—Ç—å JSON
const jsonMatch = text.match(/{[\s\S]*}/);
if (!jsonMatch) throw new Error('No JSON found');const data = JSON.parse(jsonMatch[0]);return {
merchant: data.merchant,
amount: data.amount,
currency: data.currency || 'USD',
date: data.date || new Date().toISOString().split('T')[0],
category: data.category
};
}

**–†–∞–∑–º–µ—Ä:** ~190 —Å—Ç—Ä–æ–∫ ‚úÖ

---

### –§–ê–ô–õ–´ 4-7: –ö–†–ê–¢–ö–û

**`voice.ts`** (~180 —Å—Ç—Ä–æ–∫):
- –°–∫–∞—á–∞—Ç—å voice —Ñ–∞–π–ª
- OpenAI Whisper transcription
- –ü–∞—Ä—Å–∏—Ç—å —Ç–µ–∫—Å—Ç ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

**`parser.ts`** (~160 —Å—Ç—Ä–æ–∫):
- –ü–∞—Ä—Å–∏—Ç—å "spent 20 on coffee"
- –ò–∑–≤–ª–µ—á—å amount, description, category
- ML –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞

**`notifications.ts`** (~150 —Å—Ç—Ä–æ–∫):
- `sendNotification(userId, message)`
- –ü–æ–ª—É—á–∏—Ç—å telegramId –ø–æ userId
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ bot.sendMessage

**`config.ts`** (~50 —Å—Ç—Ä–æ–∫):
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

---

## üõ£Ô∏è –®–ê–ì 3: API Endpoints (30 –º–∏–Ω—É—Ç)

### –î–æ–±–∞–≤—å –≤ `server/routes/telegram.ts`:
```typescriptimport { Router } from 'express';
import { requireAuth } from '../middleware/auth';
import { db } from '../db/client';
import { telegramVerificationCodes, users } from '@shared/schema';
import { eq, and, gt } from 'drizzle-orm';const router = Router();/**

POST /api/auth/telegram/generate-code
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
*/
router.post('/auth/telegram/generate-code', requireAuth, async (req, res) => {
try {
const userId = req.user.id;
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Telegram –µ—â—ë –Ω–µ —Å–≤—è–∑–∞–Ω
const [user] = await db
  .select()
  .from(users)
  .where(eq(users.id, userId))
  .limit(1);if (user.telegramId) {
  return res.status(400).json({ error: 'Telegram already linked' });
}// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
const code = Math.floor(100000 + Math.random() * 900000).toString(); // 6 —Ü–∏—Ñ—Ä
const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 –º–∏–Ω—É—Ç// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
await db.insert(telegramVerificationCodes).values({
  userId,
  code,
  expiresAt
});res.json({ code, expiresAt });
} catch (error) {
res.status(500).json({ error: 'Failed to generate code' });
}
});/**

POST /api/telegram/verify
–°–≤—è–∑–∞—Ç—å Telegram —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º
*/
router.post('/telegram/verify', async (req, res) => {
try {
const { telegramId, code } = req.body;
if (!telegramId || !code) {
  return res.status(400).json({ error: 'telegramId and code required' });
}// –ù–∞–π—Ç–∏ –∫–æ–¥
const [verification] = await db
  .select()
  .from(telegramVerificationCodes)
  .where(
    and(
      eq(telegramVerificationCodes.code, code),
      eq(telegramVerificationCodes.isUsed, false),
      gt(telegramVerificationCodes.expiresAt, new Date())
    )
  )
  .limit(1);if (!verification) {
  return res.status(400).json({ error: 'Invalid or expired code' });
}// –û–±–Ω–æ–≤–∏—Ç—å user
await db
  .update(users)
  .set({ 
    telegramId: telegramId.toString(),
    hasSetupTelegram: true 
  })
  .where(eq(users.id, verification.userId));// –ü–æ–º–µ—Ç–∏—Ç—å –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º
await db
  .update(telegramVerificationCodes)
  .set({ isUsed: true })
  .where(eq(telegramVerificationCodes.id, verification.id));// –ü–æ–ª—É—á–∏—Ç—å user
const [user] = await db
  .select()
  .from(users)
  .where(eq(users.id, verification.userId))
  .limit(1);res.json({ success: true, user });
} catch (error) {
res.status(500).json({ error: 'Verification failed' });
}
});export default router;

**–†–∞–∑–º–µ—Ä:** ~90 —Å—Ç—Ä–æ–∫ ‚úÖ

---

## üé® –®–ê–ì 4: Frontend (30 –º–∏–Ω—É—Ç)

### –î–æ–±–∞–≤—å –≤ `pages/Settings.tsx`:
```tsx// –í Settings.tsximport { useState } from 'react';
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Copy, CheckCircle } from 'lucide-react';
import { apiRequest } from '@/lib/api';
import { toast } from '@/hooks/use-toast';export function Settings() {
const queryClient = useQueryClient();
const [verificationCode, setVerificationCode] = useState<string | null>(null);// –ü–æ–ª—É—á–∏—Ç—å user
const { data: user } = useQuery({
queryKey: ['/api/user']
});// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞
const generateCodeMutation = useMutation({
mutationFn: async () => {
return await apiRequest('POST', '/api/auth/telegram/generate-code');
},
onSuccess: (data) => {
setVerificationCode(data.code);
toast({
title: 'Code generated',
description: 'Enter it in Telegram bot within 10 minutes'
});
}
});// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
const disconnectMutation = useMutation({
mutationFn: async () => {
return await apiRequest('POST', '/api/telegram/disconnect');
},
onSuccess: () => {
queryClient.invalidateQueries({ queryKey: ['/api/user'] });
toast({ title: 'Telegram disconnected' });
}
});const copyCode = () => {
if (verificationCode) {
navigator.clipboard.writeText(verificationCode);
toast({ title: 'Code copied!' });
}
};return (
<div className="space-y-6">
<h1 className="text-2xl font-bold">Settings</h1>  {/* Telegram Section */}
  <Card>
    <CardHeader>
      <CardTitle>ü§ñ Telegram Bot</CardTitle>
    </CardHeader>
    <CardContent className="space-y-4">
      {user?.telegramId ? (
        // –°–≤—è–∑–∞–Ω
        <div className="space-y-2">
          <div className="flex items-center gap-2 text-green-600">
            <CheckCircle className="h-5 w-5" />
            <span className="font-medium">Connected</span>
          </div>          {user.telegramUsername && (
            <p className="text-sm text-muted-foreground">
              @{user.telegramUsername}
            </p>
          )}          <p className="text-sm">
            You can now add transactions via Telegram!
          </p>          <Button
            variant="destructive"
            size="sm"
            onClick={() => disconnectMutation.mutate()}
            disabled={disconnectMutation.isPending}
          >
            Disconnect
          </Button>
        </div>
      ) : (
        // –ù–µ —Å–≤—è–∑–∞–Ω
        <div className="space-y-4">
          <p className="text-sm text-muted-foreground">
            Link your Telegram to add transactions via bot
          </p>          {!verificationCode ? (
            <Button
              onClick={() => generateCodeMutation.mutate()}
              disabled={generateCodeMutation.isPending}
            >
              {generateCodeMutation.isPending ? 'Generating...' : 'Get Verification Code'}
            </Button>
          ) : (
            <div className="space-y-2 p-4 border rounded-lg bg-muted">
              <p className="text-sm font-medium">Your verification code:</p>              <div className="flex items-center gap-2">
                <code className="text-3xl font-mono font-bold">
                  {verificationCode}
                </code>
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={copyCode}
                >
                  <Copy className="h-4 w-4" />
                </Button>
              </div>              <div className="text-sm space-y-1">
                <p>1. Open Telegram bot: <strong>@BudgetBuddyBot</strong></p>
                <p>2. Send: <code>/verify {verificationCode}</code></p>
                <p className="text-muted-foreground">Code expires in 10 minutes</p>
              </div>
            </div>
          )}
        </div>
      )}
    </CardContent>
  </Card>  {/* Other settings... */}
</div>
);
}

**–†–∞–∑–º–µ—Ä:** ~100 —Å—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ ‚úÖ

---

## üöÄ –®–ê–ì 5: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (5 –º–∏–Ω—É—Ç)

### –í `server/index.ts`:
```typescriptimport { startTelegramBot } from './telegram/bot';// ... –¥—Ä—É–≥–æ–π –∫–æ–¥ ...// –ó–∞–ø—É—Å—Ç–∏—Ç—å Telegram –±–æ—Ç–∞
if (process.env.TELEGRAM_BOT_TOKEN) {
startTelegramBot();
console.log('ü§ñ Telegram bot enabled');
} else {
console.log('‚ö†Ô∏è  Telegram bot disabled (no token)');
}

### Environment Variables:
```bash.env
TELEGRAM_BOT_TOKEN=123456:ABC-DEF...
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-...

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Test Case 1: Verification
–û—Ç–∫—Ä—ã—Ç—å Settings
–ù–∞–∂–∞—Ç—å "Get Verification Code"
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥: 123456
–û—Ç–∫—Ä—ã—Ç—å Telegram ‚Üí @BudgetBuddyBot
–û—Ç–ø—Ä–∞–≤–∏—Ç—å: /verify 123456
–ü–†–û–í–ï–†–ò–¢–¨:
‚úÖ Bot: "Account linked! Welcome, Alex"
‚úÖ Settings: "Connected"


### Test Case 2: Text Transaction
–í Telegram –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: "spent 20 on coffee"
–ü–†–û–í–ï–†–ò–¢–¨:
‚úÖ Bot: "Added: $20 - coffee"
‚úÖ App: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ—è–≤–∏–ª–∞—Å—å


### Test Case 3: Receipt OCR
–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
–ü–†–û–í–ï–†–ò–¢–¨:
‚úÖ Bot: "Processing receipt..."
‚úÖ Bot: "Amount: $45.50, Merchant: Starbucks"
‚úÖ Inline –∫–Ω–æ–ø–∫–∏: [Confirm] [Cancel]
–ù–∞–∂–∞—Ç—å Confirm
–ü–†–û–í–ï–†–ò–¢–¨:
‚úÖ Bot: "Saved"
‚úÖ App: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞


### Test Case 4: Voice
–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ: "I spent 15 dollars on lunch"
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
–ü–†–û–í–ï–†–ò–¢–¨:
‚úÖ Bot: "Processing voice..."
‚úÖ Bot: "Added: $15 - lunch"


---

## üìã –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

### Backend:
- [ ] –¢–∞–±–ª–∏—Ü–∞ telegram_verification_codes —Å–æ–∑–¥–∞–Ω–∞
- [ ] 7 —Ñ–∞–π–ª–æ–≤ –≤ telegram/ —Å–æ–∑–¥–∞–Ω—ã (<200 —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥—ã–π)
- [ ] API endpoints: /generate-code, /verify, /disconnect
- [ ] Bot –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ index.ts
- [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### Frontend:
- [ ] UI –≤ Settings –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
- [ ] –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ (connected/not connected)
- [ ] –ö–Ω–æ–ø–∫–∞ Disconnect
- [ ] Copy code —Ñ—É–Ω–∫—Ü–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- [ ] –ö–æ–º–∞–Ω–¥—ã: /start, /verify, /add, /balance
- [ ] Receipt OCR (Anthropic Vision)
- [ ] Voice recognition (OpenAI Whisper)
- [ ] Text parsing
- [ ] ML –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] Inline keyboards

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] Verification flow —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Text transactions
- [ ] Receipt OCR
- [ ] Voice messages

---

## üìÇ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–íserver/
telegram/
bot.ts                  (120 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
commands.ts             (180 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
ocr.ts                  (190 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
voice.ts                (180 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
parser.ts               (160 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
notifications.ts        (150 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
config.ts               (50 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
routes/
telegram.ts             (90 —Å—Ç—Ä–æ–∫ - –ù–û–í–´–ô!)
index.ts                  (+5 —Å—Ç—Ä–æ–∫ - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞)client/src/
pages/
Settings.tsx            (+100 —Å—Ç—Ä–æ–∫ - Telegram UI)shared/
schema.ts                 (+20 —Å—Ç—Ä–æ–∫ - —Ç–∞–±–ª–∏—Ü–∞)

**–ò–¢–û–ì–û:**
- –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã: 8
- –ù–æ–≤—ã–π –∫–æ–¥: ~1,300 —Å—Ç—Ä–æ–∫
- –í—Å–µ —Ñ–∞–π–ª—ã <200 —Å—Ç—Ä–æ–∫ ‚úÖ

---

## üéØ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –≠–¢–û–ì–û –ü–û–î–•–û–î–ê

### 1. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª <200 —Å—Ç—Ä–æ–∫
‚úÖ –õ—ë–≥–∫–æ —á–∏—Ç–∞—Ç—å
‚úÖ –õ—ë–≥–∫–æ –ø—Ä–∞–≤–∏—Ç—å
‚úÖ –õ—ë–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 2. –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è Junior‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–µ–∑–¥–µ
‚úÖ –û–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞
‚úÖ –†–∞–∑–±–µ—Ä—ë—Ç—Å—è –∑–∞ 30 –º–∏–Ω—É—Ç

### 3. –£–¥–æ–±–Ω–æ –¥–ª—è –ò–ò‚úÖ –ú–∞–ª—ã–µ —Ñ–∞–π–ª—ã
‚úÖ –ß—ë—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞
‚úÖ –ü—Ä–∞–≤–∏—Ç—å OCR ‚Üí –Ω–µ —Ç—Ä–æ–≥–∞–µ–º commands
‚úÖ –ü—Ä–∞–≤–∏—Ç—å commands ‚Üí –Ω–µ —Ç—Ä–æ–≥–∞–µ–º OCR
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è

### 4. –õ—É—á—à–µ–µ –∏–∑ –¥–≤—É—Ö –º–∏—Ä–æ–≤‚úÖ Verification code (6 —Ü–∏—Ñ—Ä) - —É–¥–æ–±–Ω–æ
‚úÖ –ú–æ–¥—É–ª–∏ - —á–∏—Å—Ç–æ
‚úÖ OCR - –º–æ—â–Ω–æ
‚úÖ Voice - wow-—Ñ–∞–∫—Ç–æ—Ä
‚úÖ ML - —É–º–Ω–æ

---

## ‚ö†Ô∏è –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨‚ùå –ù–ï –¥–µ–ª–∞—Ç—å –º–æ–Ω–æ–ª–∏—Ç 2161 —Å—Ç—Ä–æ–∫
‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å authToken (–Ω–µ—É–¥–æ–±–Ω–æ)
‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å couple logic
‚ùå –ù–ï –∑–∞–±—ã–≤–∞—Ç—å –ø—Ä–æ error handling
‚ùå –ù–ï –¥–µ–ª–∞—Ç—å BYOK (–æ–¥–∏–Ω –±–æ—Ç –¥–ª—è –≤—Å–µ—Ö)

---

## üí™ –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–•–ê

**Junior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:**
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç telegram/commands.ts
2. –í–∏–¥–∏—Ç 180 —Å—Ç—Ä–æ–∫ —á–∏—Å—Ç–æ–≥–æ –∫–æ–¥–∞
3. –ü–æ–Ω–∏–º–∞–µ—Ç –ª–æ–≥–∏–∫—É –∑–∞ 10 –º–∏–Ω—É—Ç
4. –ú–æ–∂–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /help
5. **–í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –ò –ü–û–ù–Ø–¢–ù–û!** ‚úÖ

---

**–í–†–ï–ú–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò: 2-3 —á–∞—Å–∞**