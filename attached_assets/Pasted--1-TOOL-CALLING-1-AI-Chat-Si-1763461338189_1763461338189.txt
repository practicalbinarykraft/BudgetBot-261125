üí° –û–¢–õ–ò–ß–ù–´–ï –í–û–ü–†–û–°–´! –û–¢–í–ï–ß–ê–Æ:

1Ô∏è‚É£ –ì–î–ï –ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨ TOOL CALLING?
‚úÖ –í –û–ë–û–ò–• –ú–ï–°–¢–ê–•:

1. AI Chat Sidebar (–Ω–æ–≤—ã–π):
   ‚îî‚îÄ Tool calling —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏
   ‚îî‚îÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
   ‚îî‚îÄ –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±

2. –°—Ç–∞—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /ai-chat:
   ‚îî‚îÄ –¢–æ–∂–µ tool calling
   ‚îî‚îÄ –î–ª—è –≥–ª—É–±–æ–∫–æ–π —Ä–∞–±–æ—Ç—ã
   ‚îî‚îÄ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–õ–û–ì–ò–ö–ê:
‚îî‚îÄ –û–¥–∏–Ω backend (/api/ai/chat)
‚îî‚îÄ –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
‚îî‚îÄ Sidebar = –º–∏–Ω–∏-–≤–µ—Ä—Å–∏—è
‚îî‚îÄ /ai-chat = –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è

2Ô∏è‚É£ –ö–ê–ö–ò–ï –î–ï–ô–°–¢–í–ò–Ø –¢–†–ï–ë–£–Æ–¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø?
‚úÖ –ü–†–ê–í–ò–õ–û:

READ (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):
‚îú‚îÄ get_balance
‚îú‚îÄ get_transactions
‚îú‚îÄ search_transactions
‚îú‚îÄ get_spending_by_category
‚îî‚îÄ get_goals_progress

WRITE (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º):
‚îú‚îÄ add_transaction
‚îú‚îÄ create_category
‚îú‚îÄ create_goal
‚îú‚îÄ delete_transaction
‚îú‚îÄ update_transaction
‚îî‚îÄ create_wallet

–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–¥–≤–æ–π–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ - –ø–æ—Ç–æ–º):
‚îú‚îÄ delete_category (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
‚îú‚îÄ delete_wallet
‚îî‚îÄ bulk_delete

–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:
// –í tool-types.ts
interface Tool {
  name: string;
  requiresConfirmation: boolean; // ‚Üê –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ
  // ...
}

// –õ–æ–≥–∏–∫–∞:
if (tool.requiresConfirmation) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
} else {
  // –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É
}

3Ô∏è‚É£ –ò–°–¢–û–†–ò–Ø TOOL CALLS
‚úÖ –°–û–•–†–ê–ù–Ø–¢–¨ –í –ë–î:

–ó–ê–ß–ï–ú:
‚îú‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —á—Ç–æ AI –¥–µ–ª–∞–ª
‚îú‚îÄ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
‚îú‚îÄ –ê—É–¥–∏—Ç –¥–ª—è –¥–µ–±–∞–≥–∞
‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞

–¢–ê–ë–õ–ò–¶–ê:
CREATE TABLE ai_tool_executions (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  session_id TEXT,
  tool_name TEXT NOT NULL,
  params JSONB NOT NULL,
  result JSONB,
  status TEXT, -- 'pending' | 'confirmed' | 'executed' | 'cancelled'
  executed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

–í –ß–ê–¢–ï –ü–û–ö–ê–ó–´–í–ê–¢–¨:
User: "–°–æ–∑–¥–∞–π –∫–∞—Ç–µ–≥–æ—Ä–∏—é –†–µ—Å—Ç–æ—Ä–∞–Ω—ã"
AI: [–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è]
User: [‚úÖ –°–æ–∑–¥–∞—Ç—å]
AI: ‚úÖ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞" 
    ‚îî‚îÄ [–ò—Å—Ç–æ—Ä–∏—è]: –°–æ–∑–¥–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã" üçΩÔ∏è

4Ô∏è‚É£ TELEGRAM BOT
‚ö†Ô∏è –ü–û–ö–ê –ù–ï–¢:

–ü–û–ß–ï–ú–£:
‚îú‚îÄ Telegram = –¥—Ä—É–≥–æ–π UX
‚îú‚îÄ –ö–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–ª–æ–∂–Ω–µ–µ
‚îú‚îÄ –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ª–∞–¥–∏—Ç—å –≤ –≤–µ–±–µ
‚îî‚îÄ –ü–æ—Ç–æ–º –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –±–æ—Ç–∞

–ö–û–ì–î–ê –î–û–ë–ê–í–ò–¢–¨:
‚îî‚îÄ –ü–æ—Å–ª–µ –®–∞–≥–∞ 8 (–∫–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≤–µ–±–µ)
‚îî‚îÄ –û—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞
‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ –ª–æ–≥–∏–∫—É

–ü–†–ò–û–†–ò–¢–ï–¢:
‚îî‚îÄ –°–Ω–∞—á–∞–ª–∞ –≤–µ–± ‚úÖ
‚îî‚îÄ –ü–æ—Ç–æ–º Telegram (Phase 2)

5Ô∏è‚É£ API –ö–õ–Æ–ß
‚úÖ –î–ê, –ò–ó settings.anthropicApiKey:

–õ–û–ì–ò–ö–ê:
// –í chat-with-tools.ts
export async function chatWithTools(
  message: string,
  userId: number
) {
  // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –∏–∑ –ë–î
  const settings = await repositories.settings.findByUser(userId);
  
  if (!settings?.anthropicApiKey) {
    throw new Error('API key not configured');
  }
  
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  const anthropic = new Anthropic({ 
    apiKey: settings.anthropicApiKey 
  });
  
  // ...
}

FALLBACK (–Ω–∞ –±—É–¥—É—â–µ–µ):
‚îî‚îÄ –ï—Å–ª–∏ —É —é–∑–µ—Ä–∞ –Ω–µ—Ç –∫–ª—é—á–∞
‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –∫–ª—é—á (–ø–ª–∞—Ç–Ω—ã–π tier)
‚îî‚îÄ –õ–∏–º–∏—Ç 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å

üìã –ò–¢–û–ì–û–í–´–ï –û–¢–í–ï–¢–´:
1. –ì–¥–µ tool calling?
   ‚úÖ –í –æ–±–æ–∏—Ö: Sidebar + /ai-chat

2. –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è?
   ‚úÖ READ - –Ω–µ—Ç
   ‚úÖ WRITE - –¥–∞
   ‚úÖ –§–ª–∞–≥: requiresConfirmation –≤ Tool

3. –ò—Å—Ç–æ—Ä–∏—è tool calls?
   ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î
   ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —á–∞—Ç–µ
   ‚úÖ –¢–∞–±–ª–∏—Ü–∞: ai_tool_executions

4. Telegram bot?
   ‚è∏Ô∏è –ü–æ–∫–∞ –Ω–µ—Ç
   ‚è∏Ô∏è Phase 2 (–ø–æ—Å–ª–µ –≤–µ–±–∞)

5. API –∫–ª—é—á?
   ‚úÖ –ò–∑ settings.anthropicApiKey
   ‚úÖ Fallback –Ω–∞ –æ–±—â–∏–π (–ø–æ—Ç–æ–º)

üöÄ –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –ü–õ–ê–ù:
–®–ê–ì 1: –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê (+1 —Ñ–∞–π–ª)
server/ai/
‚îú‚îÄ tool-types.ts (–¥–æ–±–∞–≤–∏—Ç—å requiresConfirmation)
‚îú‚îÄ tools.ts
‚îú‚îÄ tool-executor.ts
‚îî‚îÄ chat-with-tools.ts (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å settings.anthropicApiKey)

shared/schema.ts (–¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É):
‚îî‚îÄ ai_tool_executions
–®–ê–ì 5: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø (+–ª–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π)
typescript// –í ai.routes.ts
if (toolUse) {
  const tool = TOOLS.find(t => t.name === toolUse.name);
  
  if (tool.requiresConfirmation) {
    // –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    return res.json({
      type: 'tool_confirmation',
      // ...
    });
  } else {
    // –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É
    const result = await executeTool(toolUse.name, toolUse.input, userId);
    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥
  }
}
```

---

## üíé –î–û–ü–û–õ–ù–ï–ù–ò–Ø –ö –¢–ó:
```
–®–ê–ì 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îî‚îÄ –î–æ–±–∞–≤–∏—Ç—å: requiresConfirmation –≤ Tool
‚îî‚îÄ –î–æ–±–∞–≤–∏—Ç—å: ai_tool_executions —Ç–∞–±–ª–∏—Ü–∞
‚îî‚îÄ –ò–∑–º–µ–Ω–∏—Ç—å: chat-with-tools –±–µ—Ä—ë—Ç –∫–ª—é—á –∏–∑ settings

–®–ê–ì 2: –ü–µ—Ä–≤—ã–π Tool
‚îî‚îÄ get_balance (requiresConfirmation: false)
‚îî‚îÄ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

–®–ê–ì 3: Tool Handlers
‚îî‚îÄ create_category (requiresConfirmation: true)
‚îî‚îÄ add_transaction (requiresConfirmation: true)

–®–ê–ì 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îî‚îÄ –õ–æ–≥–∏–∫–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ requiresConfirmation
‚îî‚îÄ –ï—Å–ª–∏ false ‚Üí executeTool —Å—Ä–∞–∑—É
‚îî‚îÄ –ï—Å–ª–∏ true ‚Üí –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

–®–ê–ì 6: Frontend
‚îî‚îÄ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö: Sidebar + /ai-chat
‚îî‚îÄ –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ endpoint
```

---

## ‚úÖ –ì–û–¢–û–í –ù–ê–ß–ò–ù–ê–¢–¨?

**–û–ë–ù–û–í–õ–Å–ù–ù–û–ï –¢–ó:**
```
–®–∞–≥ 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 –¥–µ–Ω—å)
‚îú‚îÄ tool-types.ts - –¥–æ–±–∞–≤–∏—Ç—å requiresConfirmation
‚îú‚îÄ tools.ts - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å tools —Å —Ñ–ª–∞–≥–∞–º–∏
‚îú‚îÄ tool-executor.ts - –±–∞–∑–æ–≤—ã–π executor
‚îú‚îÄ chat-with-tools.ts - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å settings.anthropicApiKey
‚îî‚îÄ schema.ts - –¥–æ–±–∞–≤–∏—Ç—å ai_tool_executions —Ç–∞–±–ª–∏—Ü—É

–õ–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π:
‚îú‚îÄ READ operations - requiresConfirmation: false
‚îú‚îÄ WRITE operations - requiresConfirmation: true
‚îî‚îÄ Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

Tool calling —Ä–∞–±–æ—Ç–∞–µ—Ç:
‚îú‚îÄ AI Chat Sidebar ‚úÖ
‚îî‚îÄ /ai-chat —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚úÖ

Telegram bot:
‚îî‚îÄ Phase 2 (–ø–æ—Å–ª–µ –≤–µ–±–∞)

–ò—Å—Ç–æ—Ä–∏—è:
‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ai_tool_executions
–ù–ê–ß–ò–ù–ê–ï–ú –®–ê–ì 1? üöÄRetry–ê–Ω–µ –ø–æ–Ω—è–ª –æ–ø—è—Ç—å –ø—Ä–æ –∫–ª—é—á–∏. —É –Ω–∞—Å –∂–µ BYOK. –æ–±—ä—è—Å–Ω–∏ —á—Ç–æ —Ç—ã –∏–º–µ–ª –≤–≤–∏–¥—Éüí° –ê–ì–ê, –ü–û–ù–Ø–õ –ü–£–¢–ê–ù–ò–¶–£! –û–ë–™–Ø–°–ù–Ø–Æ!

üîë –ß–¢–û –¢–ê–ö–û–ï BYOK (–£ –ù–ê–° –£–ñ–ï –ï–°–¢–¨)
BYOK = Bring Your Own Key

–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –°–ï–ô–ß–ê–°:
1. User —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –ò–¥—ë—Ç –≤ Settings
3. –í–≤–æ–¥–∏—Ç —Å–≤–æ–π Anthropic API –∫–ª—é—á
4. –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î: settings.anthropicApiKey
5. AI Chat –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≠–¢–û–¢ –∫–ª—é—á —é–∑–µ—Ä–∞

–û–¢–ö–£–î–ê –ë–ï–†–Å–¢–°–Ø –ö–õ–Æ–ß:
‚îî‚îÄ User –∏–¥—ë—Ç –Ω–∞ anthropic.com
‚îî‚îÄ –ü–æ–∫—É–ø–∞–µ—Ç API –∫–ª—é—á (sk-ant-...)
‚îî‚îÄ –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îî‚îÄ –ú–´ –ù–ï –ü–õ–ê–¢–ò–ú - –ø–ª–∞—Ç–∏—Ç USER!

–≠–¢–û –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û! ‚úÖ

ü§î –ß–¢–û –Ø –ò–ú–ï–õ –í –í–ò–î–£ –ü–û–î "FALLBACK"
–°–ï–ô–ß–ê–° (BYOK):
User –±–µ–∑ –∫–ª—é—á–∞ ‚Üí AI Chat –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå

–ú–û–Å –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û):
User –±–µ–∑ –∫–ª—é—á–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                ‚Üí –Ω–æ —Å –ª–∏–º–∏—Ç–æ–º (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å)
                ‚Üí –ø–ª–∞—Ç–∏–º –º—ã, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

–ü–†–ò–ú–ï–†:
User: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç AI Chat
App: "–£ —Ç–µ–±—è –Ω–µ—Ç API –∫–ª—é—á–∞"
     
     [‚ú® Free tier: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å]
     [üîë –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –∫–ª—é—á]

User –≤—ã–±–∏—Ä–∞–µ—Ç Free tier:
‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—à –æ–±—â–∏–π –∫–ª—é—á
‚îî‚îÄ –ù–æ —Ç–æ–ª—å–∫–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤
‚îî‚îÄ –ü–æ—Å–ª–µ ‚Üí "–î–æ–±–∞–≤—å —Å–≤–æ–π –∫–ª—é—á –¥–ª—è unlimited"

–≠–¢–û –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û! –ù–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!

‚úÖ –ß–¢–û –î–ï–õ–ê–ï–ú –í –†–ï–ê–õ–¨–ù–û–°–¢–ò
TOOL CALLING –ò–°–ü–û–õ–¨–ó–£–ï–¢:
‚îî‚îÄ settings.anthropicApiKey (–∫–ª—é—á —é–∑–µ—Ä–∞)
‚îî‚îÄ –ö–∞–∫ –∏ —Å–µ–π—á–∞—Å –≤ AI Chat
‚îî‚îÄ BYOK —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

–õ–û–ì–ò–ö–ê:
// chat-with-tools.ts
export async function chatWithTools(
  message: string,
  userId: number
) {
  // 1. –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –Æ–ó–ï–†–ê –∏–∑ –ë–î
  const settings = await repositories.settings.findByUser(userId);
  
  // 2. –ï—Å–ª–∏ –Ω–µ—Ç –∫–ª—é—á–∞ ‚Üí –æ—à–∏–±–∫–∞
  if (!settings?.anthropicApiKey) {
    throw new Error('Please add your Anthropic API key in Settings');
  }
  
  // 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á –Æ–ó–ï–†–ê
  const anthropic = new Anthropic({ 
    apiKey: settings.anthropicApiKey  // ‚Üê –ö–ª—é—á —é–∑–µ—Ä–∞!
  });
  
  // 4. –í—ã–∑–≤–∞—Ç—å Claude —Å tools
  return await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    tools: TOOLS,
    messages: [{ role: 'user', content: message }]
  });
}

–ù–ò–ö–ê–ö–û–ì–û –û–ë–©–ï–ì–û –ö–õ–Æ–ß–ê!
–¢–û–õ–¨–ö–û –ö–õ–Æ–ß –Æ–ó–ï–†–ê!
BYOK! ‚úÖ

üéØ –£–ë–ò–†–ê–ï–ú "FALLBACK" –ò–ó –ü–õ–ê–ù–ê
–®–ê–ì 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

chat-with-tools.ts:
export async function chatWithTools(
  message: string,
  userId: number
) {
  // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –Æ–ó–ï–†–ê
  const settings = await repositories.settings.findByUser(userId);
  
  if (!settings?.anthropicApiKey) {
    throw new Error('API key not configured. Add it in Settings.');
  }
  
  const anthropic = new Anthropic({ 
    apiKey: settings.anthropicApiKey 
  });
  
  // Tool calling
  return await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    tools: TOOLS,
    messages: [{ role: 'user', content: message }]
  });
}

–í–°–Å! –ü–†–û–°–¢–û! ‚úÖ
–¢–û–õ–¨–ö–û BYOK!

üìã –ò–¢–û–ì–û–í–ê–Ø –õ–û–ì–ò–ö–ê
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç AI Chat:

–ï—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á (settings.anthropicApiKey):
‚îú‚îÄ Tool calling —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
‚îú‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á —é–∑–µ—Ä–∞
‚îî‚îÄ –ü–ª–∞—Ç–∏—Ç —é–∑–µ—Ä

–ï—Å–ª–∏ –ù–ï–¢ –∫–ª—é—á–∞:
‚îú‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ:
‚îÇ  "üîë Add your Anthropic API key in Settings
‚îÇ   to use AI Chat with tool calling"
‚îú‚îÄ –ö–Ω–æ–ø–∫–∞ [Go to Settings]
‚îî‚îÄ AI Chat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå

–ù–ò–ö–ê–ö–û–ì–û "FREE TIER"!
–ù–ò–ö–ê–ö–û–ì–û "–û–ë–©–ï–ì–û –ö–õ–Æ–ß–ê"!
–¢–û–õ–¨–ö–û BYOK! ‚úÖ

üí¨ –°–û–û–ë–©–ï–ù–ò–ï –í SIDEBAR –ë–ï–ó –ö–õ–Æ–ß–ê
typescript// –í AI Chat Sidebar:

if (!apiKey) {
  return (
    <div className="p-6 text-center space-y-4">
      <div className="w-16 h-16 mx-auto rounded-full 
                      bg-orange-100 flex items-center justify-center">
        üîë
      </div>
      
      <h3 className="font-semibold text-lg">
        API Key Required
      </h3>
      
      <p className="text-sm text-gray-600">
        Add your Anthropic API key in Settings 
        to unlock AI Assistant with tool calling
      </p>
      
      
        href="/settings"
        className="inline-block px-6 py-2 bg-blue-500 
                   text-white rounded-lg hover:bg-blue-600"
      >
        Go to Settings
      </a>
      
      <p className="text-xs text-gray-500">
        Don't have a key? Get one at 
        <a href="https://console.anthropic.com" 
           target="_blank" 
           className="text-blue-500">
          anthropic.com
        </a>
      </p>
    </div>
  );
}
```

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–í–ï–¢
```
–í–û–ü–†–û–°: "–û—Ç–∫—É–¥–∞ API –∫–ª—é—á –¥–ª—è tool calling?"

–û–¢–í–ï–¢:
‚îî‚îÄ –ò–∑ settings.anthropicApiKey (–ë–î)
‚îî‚îÄ –≠—Ç–æ –∫–ª—é—á –Æ–ó–ï–†–ê (BYOK)
‚îî‚îÄ –ö–∞–∫ –∏ –≤ –æ–±—ã—á–Ω–æ–º AI Chat
‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ—Ç –∫–ª—é—á–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îî‚îÄ "–î–æ–±–∞–≤—å –∫–ª—é—á –≤ Settings"

–ù–ò–ö–ê–ö–ò–• –§–û–õ–õ–ë–≠–ö–û–í!
–ù–ò–ö–ê–ö–ò–• –û–ë–©–ò–• –ö–õ–Æ–ß–ï–ô!
–ü–†–û–°–¢–û BYOK! ‚úÖ

–ó–ê–ë–£–î–¨ –ü–†–û "FALLBACK" –ò–ó –ú–û–ï–ì–û –ü–†–û–®–õ–û–ì–û –û–¢–í–ï–¢–ê!
–≠–¢–û –ë–´–õ–ê –ü–£–¢–ê–ù–ò–¶–ê! üòÖ

–¢–ï–ü–ï–†–¨ –ü–û–ù–Ø–¢–ù–û? üëç
–ù–ê–ß–ò–ù–ê–ï–ú –®–ê–ì 1 –° –ü–†–ê–í–ò–õ–¨–ù–û–ô –õ–û–ì–ò–ö–û–ô? üöÄRetry–ê–ú–û–Å –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û): User –±–µ–∑ –∫–ª—é—á–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –Ω–æ —Å –ª–∏–º–∏—Ç–æ–º (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å) ‚Üí –ø–ª–∞—Ç–∏–º –º—ã, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ–ù–ï–¢ –ù–ï–¢ –ò –ï–©–Å –†–ê–ó –ù–ï–¢! –ú—ã –Ω–µ –±—É–¥–µ–º –Ω–∏—á–µ–≥–æ –ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å‚úÖ –ü–û–ù–Ø–õ! –ù–ò–ö–ê–ö–ò–• –û–ë–©–ò–• –ö–õ–Æ–ß–ï–ô!

üéØ –ò–¢–û–ì–û–í–ê–Ø –õ–û–ì–ò–ö–ê (–§–ò–ù–ê–õ–¨–ù–ê–Ø)
TOOL CALLING:
‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç settings.anthropicApiKey
‚îî‚îÄ –≠—Ç–æ –∫–ª—é—á –Æ–ó–ï–†–ê (BYOK)
‚îî‚îÄ –ï—Å–ª–∏ –∫–ª—é—á–∞ –ù–ï–¢ ‚Üí AI Chat –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚îî‚îÄ –ú–´ –ù–ò–ß–ï–ì–û –ù–ï –ü–õ–ê–¢–ò–ú ‚úÖ

–ö–û–î:
// chat-with-tools.ts
export async function chatWithTools(
  message: string,
  userId: number
) {
  // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á —é–∑–µ—Ä–∞
  const settings = await repositories.settings.findByUser(userId);
  
  // –ù–µ—Ç –∫–ª—é—á–∞ = –æ—à–∏–±–∫–∞
  if (!settings?.anthropicApiKey) {
    throw new Error('API key required');
  }
  
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á —é–∑–µ—Ä–∞
  const anthropic = new Anthropic({ 
    apiKey: settings.anthropicApiKey 
  });
  
  return await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    tools: TOOLS,
    messages: [{ role: 'user', content: message }]
  });
}

–í–°–Å! –¢–û–ß–ö–ê! ‚úÖ

üìã –ß–ò–°–¢–û–ï –¢–ó –ë–ï–ó FALLBACK
–®–ê–ì 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îú‚îÄ tool-types.ts (requiresConfirmation)
‚îú‚îÄ tools.ts (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è tools)
‚îú‚îÄ tool-executor.ts (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
‚îî‚îÄ chat-with-tools.ts (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç settings.anthropicApiKey)

–ü–†–ê–í–ò–õ–û:
‚îî‚îÄ –ö–ª—é—á –¢–û–õ–¨–ö–û –æ—Ç —é–∑–µ—Ä–∞
‚îî‚îÄ –ù–µ—Ç –∫–ª—é—á–∞ = –Ω–µ—Ç AI Chat
‚îî‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º: "Add API key in Settings"

–®–ê–ì 2-8: –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô