üìã –®–ê–ì 1: DATABASE SCHEMA (15 –º–∏–Ω—É—Ç)‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
–ó–ê–î–ê–ß–ê 1.1: –°–û–ó–î–ê–¢–¨ –¢–ê–ë–õ–ò–¶–´ –î–õ–Ø PRODUCT CATALOG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–§–ê–ô–õ: shared/schema.ts

–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–ù–ï–¶ –§–ê–ô–õ–ê (–ø–æ—Å–ª–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü):

// ========================================
// PRODUCT CATALOG TABLES
// ========================================

// 1. –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
export const productCatalog = pgTable('product_catalog', {
  id: serial('id').primaryKey(),
  userId: integer('user_id').references(() => users.id, { onDelete: 'cascade' }).notNull(),
  
  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  name: text('name').notNull(), // "–ú–∞–∫–∞—Ä–æ–Ω—ã Barilla ‚Ññ 5"
  normalizedName: text('normalized_name').notNull(), // "–º–∞–∫–∞—Ä–æ–Ω—ã barilla 5"
  
  // –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
  brand: text('brand'), // "Barilla"
  weight: text('weight'), // "500–≥"
  unit: text('unit'), // "—à—Ç", "–∫–≥", "–ª"
  
  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
  category: text('category'), // "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è"
  subcategory: text('subcategory'), // "–ú–∞–∫–∞—Ä–æ–Ω—ã"
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫
  purchaseCount: integer('purchase_count').default(0),
  lastPurchaseDate: text('last_purchase_date'), // YYYY-MM-DD
  
  // –¶–µ–Ω—ã (–¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
  averagePrice: decimal('average_price', { precision: 10, scale: 2 }),
  bestPrice: decimal('best_price', { precision: 10, scale: 2 }),
  bestStore: text('best_store'),
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  imageUrl: text('image_url'),
  barcode: text('barcode'),
  
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow()
});

// 2. –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º
export const productPriceHistory = pgTable('product_price_history', {
  id: serial('id').primaryKey(),
  productId: integer('product_id').references(() => productCatalog.id, { onDelete: 'cascade' }).notNull(),
  
  // –ú–∞–≥–∞–∑–∏–Ω
  storeName: text('store_name').notNull(),
  storeAddress: text('store_address'),
  
  // –¶–µ–Ω–∞
  price: decimal('price', { precision: 10, scale: 2 }).notNull(),
  currency: varchar('currency', { length: 3 }).default('USD'),
  
  // –î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏
  purchaseDate: text('purchase_date').notNull(), // YYYY-MM-DD
  
  // –°–≤—è–∑—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  transactionId: integer('transaction_id').references(() => dailyTransactions.id),
  
  createdAt: timestamp('created_at').defaultNow()
});

// 3. –û—Ç—á—ë—Ç—ã AI-–ø–æ–∏—Å–∫–∞ —Ü–µ–Ω
export const priceSearchReports = pgTable('price_search_reports', {
  id: serial('id').primaryKey(),
  productId: integer('product_id').references(() => productCatalog.id, { onDelete: 'cascade' }).notNull(),
  userId: integer('user_id').references(() => users.id, { onDelete: 'cascade' }).notNull(),
  
  // –ö–æ–≥–¥–∞ –∏—Å–∫–∞–ª–∏
  searchDate: timestamp('search_date').defaultNow(),
  
  // –°—Ç–∞—Ç—É—Å –ø–æ–∏—Å–∫–∞
  status: text('status').default('pending'), // 'pending' | 'completed' | 'failed'
  
  // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (JSON –º–∞—Å—Å–∏–≤ –º–∞–≥–∞–∑–∏–Ω–æ–≤)
  results: jsonb('results'), // [{ store, price, url, availability }]
  
  // –õ—É—á—à–∞—è –Ω–∞–π–¥–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞
  bestPrice: decimal('best_price', { precision: 10, scale: 2 }),
  bestStore: text('best_store'),
  bestUrl: text('best_url'),
  
  // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π
  currentPrice: decimal('current_price', { precision: 10, scale: 2 }),
  savings: decimal('savings', { precision: 10, scale: 2 }),
  savingsPercent: decimal('savings_percent', { precision: 5, scale: 2 }),
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  searchQuery: text('search_query'),
  searchMethod: text('search_method'), // 'ai' | 'api' | 'scraping'
  errorMessage: text('error_message'),
  
  createdAt: timestamp('created_at').defaultNow()
});

// Type exports
export type ProductCatalog = typeof productCatalog.$inferSelect;
export type InsertProductCatalog = typeof productCatalog.$inferInsert;
export type ProductPriceHistory = typeof productPriceHistory.$inferSelect;
export type InsertProductPriceHistory = typeof productPriceHistory.$inferInsert;
export type PriceSearchReport = typeof priceSearchReports.$inferSelect;
export type InsertPriceSearchReport = typeof priceSearchReports.$inferInsert;

–ü–û–°–õ–ï –î–û–ë–ê–í–õ–ï–ù–ò–Ø:
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å: npm run db:push
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –±–∞–∑–µ

–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:
‚úÖ 3 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
‚úÖ Foreign keys –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
‚úÖ Type exports –¥–æ—Å—Ç—É–ø–Ω—ã