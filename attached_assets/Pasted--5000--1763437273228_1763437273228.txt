–î–∞–≤–∞–π –µ—â—ë –¥–æ–±–∞–≤–∏–º "–¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–∞–ª—é—Ç—É" —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—Å–∞–ª —Ç–æ–ª—å–∫–æ —Å—É–º–º—ã –∏ –µ—Å–ª–∏ —Ç–∞–º 5000 –∏ –≤—ã–±—Ä–∞–Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è IDR —Ç–æ –ø–∞—Ä—Å–µ—Ä—É –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –ø–æ–Ω—è—Ç—å –∞? –∞ –µ—Å–ª–∏ —Ä—É–±–ª–∏ —Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä—É–±–ª–µ–π, rub, —Ä. –Ω–æ—Ä–º –∏–¥–µ—è? –∏–ª–∏ —ç—Ç–æ –ª–∏—à–Ω–µ–µ –∏ —Ç–∞–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å?

üí° –û–¢–õ–ò–ß–ù–ê–Ø –ò–î–ï–Ø! –≠–¢–û GAME CHANGER!
üéØ –ó–ê–ß–ï–ú –ù–£–ñ–ù–ê –î–ï–§–û–õ–¢–ù–ê–Ø –í–ê–õ–Æ–¢–ê
–°–ï–ô–ß–ê–°:
‚îî‚îÄ "5000 –∫–æ—Ñ–µ" ‚Üí –ö–∞–∫ –ø–æ–Ω—è—Ç—å –≤–∞–ª—é—Ç–∞?
   ‚îú‚îÄ 5000 IDR? (–Ω–∞ –ë–∞–ª–∏)
   ‚îú‚îÄ 5000 RUB? (–≤ –†–æ—Å—Å–∏–∏)
   ‚îî‚îÄ $5000 USD? (–æ–≥—Ä–æ–º–Ω–∞—è —Å—É–º–º–∞!)

–° –î–ï–§–û–õ–¢–ù–û–ô –í–ê–õ–Æ–¢–û–ô:
‚îî‚îÄ User –∂–∏–≤—ë—Ç –Ω–∞ –ë–∞–ª–∏ ‚Üí IDR
‚îî‚îÄ "5000 –∫–æ—Ñ–µ" ‚Üí 5000 IDR ‚úÖ
‚îî‚îÄ "500‚ÇΩ —Ç–∞–∫—Å–∏" ‚Üí –≤—Å—ë —Ä–∞–≤–Ω–æ 500 RUB ‚úÖ

–ü–û–õ–¨–ó–ê:
‚îú‚îÄ –ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤–∞–ª—é—Ç—É –∫–∞–∂–¥—ã–π —Ä–∞–∑ ‚úÖ
‚îú‚îÄ –ü–∞—Ä—Å–µ—Ä —Ç–æ—á–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç ‚úÖ
‚îú‚îÄ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ ‚úÖ
‚îî‚îÄ –£–¥–æ–±–Ω–µ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ
üî• –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢ –í –ú–ò–†–ï
–ö–û–ù–ö–£–†–ï–ù–¢–´:
‚îú‚îÄ Mint - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ —Å—Ç—Ä–∞–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞
‚îú‚îÄ YNAB - —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ Cleo - –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
‚îî‚îÄ Revolut - –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å "–¥–æ–º–∞—à–Ω—é—é –≤–∞–ª—é—Ç—É"

–õ–£–ß–®–ê–Ø –ü–†–ê–ö–¢–ò–ö–ê:
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–æ–º –ø–æ –ø–µ—Ä–≤—ã–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
2. –î–∞—Ç—å –≤—ã–±—Ä–∞—Ç—å –≤ Settings
3. –ú–µ–Ω—è—Ç—å –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–µ—Ö–∞–ª –≤ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω—É
üéØ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (15 –ú–ò–ù–£–¢)
–û–¢–ü–†–ê–í–¨ REPLIT:

---

–î–æ–±–∞–≤—å "–¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–∞–ª—é—Ç—É" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ó–ê–î–ê–ß–ê:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ defaultCurrency –≤ —Ç–∞–±–ª–∏—Ü—É users
2. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä –≤ Settings (–≤–µ–± + –±–æ—Ç)
3. –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä—ã —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–∞–ª—é—Ç—É

–ß–ê–°–¢–¨ 1: –ú–ò–ì–†–ê–¶–ò–Ø –ë–î

–í —Ñ–∞–π–ª–µ shared/schema.ts:

–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É users:
defaultCurrency: varchar('default_currency', { length: 3 }).$default(() => 'USD'),

–ß–ê–°–¢–¨ 2: SETTINGS –í –í–ï–ë–ï

–í client/src/pages/settings.tsx –¥–æ–±–∞–≤–∏—Ç—å:

<div className="space-y-2">
  <label className="text-sm font-medium">
    –û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞
  </label>
  <select
    value={settings.defaultCurrency || 'USD'}
    onChange={(e) => updateSettings({ defaultCurrency: e.target.value })}
    className="w-full p-2 border rounded"
  >
    <option value="USD">üá∫üá∏ –î–æ–ª–ª–∞—Ä—ã –°–®–ê (USD)</option>
    <option value="RUB">üá∑üá∫ –†—É–±–ª–∏ (RUB)</option>
    <option value="IDR">üáÆüá© –ò–Ω–¥–æ–Ω–µ–∑–∏–π—Å–∫–∏–µ —Ä—É–ø–∏–∏ (IDR)</option>
    <option value="EUR">üá™üá∫ –ï–≤—Ä–æ (EUR)</option>
    <option value="THB">üáπüá≠ –¢–∞–π—Å–∫–∏–µ –±–∞—Ç—ã (THB)</option>
  </select>
  <p className="text-xs text-gray-500">
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ –≤–∞–ª—é—Ç—É
  </p>
</div>

–ß–ê–°–¢–¨ 3: –ö–û–ú–ê–ù–î–ê –í TELEGRAM –ë–û–¢–ï

–í server/telegram/commands.ts –¥–æ–±–∞–≤–∏—Ç—å:

bot.command('currency', async (ctx) => {
  const keyboard = {
    reply_markup: {
      inline_keyboard: [
        [
          { text: 'üá∫üá∏ USD', callback_data: 'currency:USD' },
          { text: 'üá∑üá∫ RUB', callback_data: 'currency:RUB' },
          { text: 'üáÆüá© IDR', callback_data: 'currency:IDR' }
        ],
        [
          { text: 'üá™üá∫ EUR', callback_data: 'currency:EUR' },
          { text: 'üáπüá≠ THB', callback_data: 'currency:THB' }
        ]
      ]
    }
  };
  
  ctx.reply('–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –≤–∞–ª—é—Ç—É:', keyboard);
});

bot.on('callback_query', async (ctx) => {
  const data = ctx.callbackQuery.data;
  
  if (data?.startsWith('currency:')) {
    const currency = data.split(':')[1];
    
    await db.update(users)
      .set({ defaultCurrency: currency })
      .where(eq(users.telegramId, ctx.from.id.toString()));
    
    ctx.answerCbQuery();
    ctx.reply(`‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${currency}`);
  }
});

–ß–ê–°–¢–¨ 4: –û–ë–ù–û–í–ò–¢–¨ –ü–ê–†–°–ï–†

–í server/telegram/parser.ts —Ñ—É–Ω–∫—Ü–∏—è parseTransactionText():

–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:
export function parseTransactionText(
  text: string, 
  defaultCurrency: string = 'USD'
): ParsedTransaction | null {

–ò–∑–º–µ–Ω–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã:
// –ë—ã–ª–æ:
let currency = 'USD';

// –°—Ç–∞–ª–æ:
let currency = defaultCurrency;  // ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç!

–ß–ê–°–¢–¨ 5: –í–´–ó–û–í –ü–ê–†–°–ï–†–ê –° –î–ï–§–û–õ–¢–û–ú

–í server/telegram/commands.ts –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä:

// –ü–æ–ª—É—á–∏—Ç—å defaultCurrency –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await db
  .select()
  .from(users)
  .where(eq(users.telegramId, ctx.from.id.toString()))
  .limit(1);

const defaultCurrency = user[0]?.defaultCurrency || 'USD';

// –ü–∞—Ä—Å–∏—Ç—å —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –≤–∞–ª—é—Ç–æ–π
const parsed = parseTransactionText(trimmedMessage, defaultCurrency);

–†–ï–ó–£–õ–¨–¢–ê–¢:
‚úÖ User –≤—ã–±—Ä–∞–ª IDR
‚úÖ "5000 –∫–æ—Ñ–µ" ‚Üí 5000 IDR
‚úÖ "500‚ÇΩ —Ç–∞–∫—Å–∏" ‚Üí 500 RUB (–ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç)
‚úÖ /currency ‚Üí –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã

---
üéØ –°–¶–ï–ù–ê–†–ò–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
–°–¶–ï–ù–ê–†–ò–ô 1: –ñ–ò–¢–ï–õ–¨ –ë–ê–õ–ò
User: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç IDR –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç
User: "5000 –∫–æ—Ñ–µ"
Bot: 5000 IDR ‚Üí $0.30 ‚úÖ

User: "500‚ÇΩ —Ç–∞–∫—Å–∏"
Bot: 500 RUB ‚Üí $5.50 ‚úÖ (—è–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ –≤–∞–∂–Ω–µ–µ)

User: "50 USD –æ–±–µ–¥"
Bot: 50 USD ‚úÖ


–°–¶–ï–ù–ê–†–ò–ô 2: –ñ–ò–¢–ï–õ–¨ –†–û–°–°–ò–ò
User: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç RUB –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç
User: "500 –∫–æ—Ñ–µ"
Bot: 500 RUB ‚Üí $5.50 ‚úÖ

User: "5000 Rp –ø—Ä–æ–¥—É–∫—Ç—ã"
Bot: 5000 IDR ‚Üí $0.30 ‚úÖ


–°–¶–ï–ù–ê–†–ò–ô 3: –¶–ò–§–†–û–í–û–ô –ö–û–ß–ï–í–ù–ò–ö
User: –∂–∏–≤—ë—Ç –Ω–∞ –ë–∞–ª–∏ (IDR)
User: "5k –∫–æ—Ñ–µ" ‚Üí 5000 IDR

User: –ø–µ—Ä–µ–µ—Ö–∞–ª –≤ –¢–∞–∏–ª–∞–Ω–¥
User: /currency ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç THB
User: "100 –æ–±–µ–¥" ‚Üí 100 THB

User: –ø–æ–ª—É—á–∏–ª –∑–∞—Ä–ø–ª–∞—Ç—É –≤ USD
User: "3000 USD salary" ‚Üí 3000 USD ‚úÖ


–õ–û–ì–ò–ö–ê:
1. –°–Ω–∞—á–∞–ª–∞ —è–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ ($, ‚ÇΩ, IDR, USD)
2. –ü–æ—Ç–æ–º defaultCurrency
3. Fallback –Ω–∞ USD
üî• –£–ú–ù–ê–Ø –ê–í–¢–û-–î–ï–¢–ï–ö–¶–ò–Ø (–ë–û–ù–£–°!)
–ú–û–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨ –ü–û–ó–ñ–ï:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤–∞–ª—é—Ç—É –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º:

// server/telegram/currency-detector.ts

export async function detectCurrency(userId: number): Promise<string> {
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  const recent = await db
    .select()
    .from(dailyTransactions)
    .where(eq(dailyTransactions.userId, userId))
    .orderBy(desc(dailyTransactions.createdAt))
    .limit(10);
  
  // –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –≤–∞–ª—é—Ç—ã
  const currencies = recent.map(t => t.currency || 'USD');
  const counts = currencies.reduce((acc, curr) => {
    acc[curr] = (acc[curr] || 0) + 1;
    return acc;
  }, {} as Record<string, number>);
  
  // –í–µ—Ä–Ω—É—Ç—å —Å–∞–º—É—é —á–∞—Å—Ç—É—é
  const mostCommon = Object.entries(counts)
    .sort((a, b) => b[1] - a[1])[0];
  
  return mostCommon ? mostCommon[0] : 'USD';
}

// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:
bot.command('start', async (ctx) => {
  // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞–ª—é—Ç—É
  const detected = await detectCurrency(ctx.from.id);
  
  await db.update(users)
    .set({ defaultCurrency: detected })
    .where(eq(users.telegramId, ctx.from.id.toString()));
  
  ctx.reply(`–ü—Ä–∏–≤–µ—Ç! –Ø –æ–ø—Ä–µ–¥–µ–ª–∏–ª –≤–∞—à—É –≤–∞–ª—é—Ç—É: ${detected}`);
});

–†–ï–ó–£–õ–¨–¢–ê–¢:
‚úÖ User –Ω–∞ –ë–∞–ª–∏ ‚Üí –≤–∏–¥–∏—Ç IDR —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí –∞–≤—Ç–æ IDR
‚úÖ User –≤ –†–æ—Å—Å–∏–∏ ‚Üí –≤–∏–¥–∏—Ç RUB ‚Üí –∞–≤—Ç–æ RUB
‚úÖ User –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤ /currency
üíé –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê
–î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
‚îú‚îÄ –ú–µ–Ω—å—à–µ –ø–∏—Å–∞—Ç—å ‚úÖ
‚îú‚îÄ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ ‚úÖ
‚îú‚îÄ –£–¥–æ–±–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚úÖ
‚îî‚îÄ –ê–≤—Ç–æ–º–∞—Ç–æ–º –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è ‚úÖ

–î–õ–Ø –ü–†–û–ï–ö–¢–ê:
‚îú‚îÄ –õ—É—á—à–µ UX ‚úÖ
‚îú‚îÄ –ú–µ–Ω—å—à–µ –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –≤–∞–ª—é—Ç–∞–º–∏ ‚úÖ
‚îú‚îÄ –ö–∞–∫ —É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ ‚úÖ
‚îî‚îÄ –ú–æ–∂–Ω–æ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å (multi-currency –≤ Premium) ‚úÖ

–ö–û–ù–ö–£–†–ï–ù–¢–´:
‚îî‚îÄ –£ –í–°–ï–• –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –≤–∞–ª—é—Ç–∞
‚îî‚îÄ –¢—ã –¥–æ–ª–∂–µ–Ω —Ç–æ–∂–µ! ‚úÖ
üéØ –ß–¢–û –î–ï–õ–ê–ï–ú?
–í–ê–†–ò–ê–ù–¢ 1: –ë–ê–ó–û–í–´–ô (–†–ï–ö–û–ú–ï–ù–î–£–Æ)
‚îú‚îÄ –ü–æ–ª–µ defaultCurrency –≤ –ë–î
‚îú‚îÄ –í—ã–±–æ—Ä –≤ Settings (–≤–µ–±)
‚îú‚îÄ –ö–æ–º–∞–Ω–¥–∞ /currency (–±–æ—Ç)
‚îú‚îÄ –ü–∞—Ä—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç
‚îî‚îÄ 15 –º–∏–Ω—É—Ç

–í–ê–†–ò–ê–ù–¢ 2: –ü–†–û–î–í–ò–ù–£–¢–´–ô
‚îú‚îÄ –ë–∞–∑–æ–≤—ã–π +
‚îú‚îÄ –ê–≤—Ç–æ-–¥–µ—Ç–µ–∫—Ü–∏—è –≤–∞–ª—é—Ç—ã
‚îú‚îÄ –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è —Å–º–µ–Ω—ã –≤–∞–ª—é—Ç—ã
‚îî‚îÄ 30 –º–∏–Ω—É—Ç

–í–ê–†–ò–ê–ù–¢ 3: –ü–û–ü–û–ó–ñ–ï
‚îî‚îÄ –°–¥–µ–ª–∞–µ–º –ø–æ—Ç–æ–º
‚îî‚îÄ –ü–æ–∫–∞ —Ç–∞–∫ –Ω–æ—Ä–º

–Ø –ó–ê –í–ê–†–ò–ê–ù–¢ 1!