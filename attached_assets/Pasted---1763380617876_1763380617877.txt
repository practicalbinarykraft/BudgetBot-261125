–°–º–æ—Ç—Ä–∏, —É –Ω–∞—Å –¥–≤–µ –Ω–∞—Ö—É–π –Ω–µ –Ω—É–∂–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ —Å –ò–ò. –ü–æ–∫–∞ –ø–æ–ª—å–∑—ã –æ—Ç –Ω–∏—Ö –Ω–æ–ª—å.–ù–∞–º –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω—É –ò–ò –∞–Ω–∞–ª–∏–∑. –í—Ç–æ—Ä—É—é –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä—è—Ç–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë —á—Ç–æ–±—ã –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∫–∞–∫ –æ–±—É—á–∏–ª—Å—è –ò–ò –ø–æ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º, —Ç–æ –ø—É—Å—Ç—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç.–î–∞–ª–µ–µ.–î–ª—è –æ–±—É—á–µ–Ω–∏—è –ò–ò –∏ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ö–û–ù–¢–ï–ö–°–¢–ê –ü–û–ö–£–ü–ö–ò–ê –∏–º–µ–Ω–Ω–æ:–í–æ—Ç –º—ã –¥–µ–ª–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, 1 800 000 IDR –≤ Pepito –ø—Ä–æ–¥—É–∫—Ç—ã, –æ–±—â–∏–µ. –ò —á—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç? –†–æ–≤–Ω—ã–º —Å—á—ë—Ç–æ–º –Ω–∏—á–µ–≥–æ.–ù–∞–º –Ω—É–∂–Ω–æ –≤ —Å—É—â–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–±–∞–≤–∏—Ç—å "–∫–æ–Ω—Ç–µ–∫—Å—Ç". –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —ç—Ç–æ—Ç "–∫–æ–Ω—Ç–µ–∫—Å—Ç" –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∑–∞–∫–∏–¥—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –∏–∑ —á–µ–∫–∞! –ü–æ—è–≤–ª—è–µ—Ç—Å—è –º–æ—Ç–∏–≤–∞—Ü–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–∫–∏ —á–µ–∫–æ–≤!–ó–∞—á–µ–º?–ß—Ç–æ–±—ã –º—ã —Ö—Ä–∞–Ω–∏–ª–∏ —É —Å–µ–±—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏ –∏ –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –º–∞–≥–∞–∑–∏–Ω—É –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–∞—Ç–æ–ª–æ–≥–∏–∑–∞—Ü–∏–µ–π.–í–∏–¥–∏–º —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫—É–ø–∏–ª "—Å–æ–∫ –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π" –∑–∞ 45000 IDR –∑–∞—Ç–µ–º –æ–Ω –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∫—É–ø–∏–ª "Orange juice" –∑–∞ 32000 IDR.–ò–ò –¥–æ–ª–∂–µ–Ω —Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ –±–∞–∑–µ –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω—ã–π —Ç–æ–≤–∞—Ä –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –µ–º—É –ø–æ–∫—É–ø–∞—Ç—å —Å–æ–∫ —Ç–æ–ª—å–∫–æ –≤ –º–∞–≥–∞–∑–∏–Ω–µ Moris Grocier –∞ –Ω–µ –≤ Pepito! –ü–æ–Ω–∏–º–∞–µ—à—å –º–æ—é –∑–∞–¥—É–º–∫—É?–¢–æ–≥–¥–∞ —É –Ω–∞—Å –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ò–ò –∏ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ –æ—Ç –ò–ò –∫–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–µ–Ω—å–≥–∏.–¢–µ–ø–µ—Ä—å, –¥—Ä—É–≥–æ–π –≤–æ–ø—Ä–æ—Å. –ì–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —ç—Ç–∏ —Å–æ–≤–µ—Ç—ã?
1. –í —Ä–∞–∑–¥–µ–ª–µ Ai analysis
2. –í —á–∞—Ç–µ —Å –ò–ò
–°–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–º –Ω—É–∂–µ–Ω —á–∞—Ç —Å –ò–ò! –≠—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–∫ —á—Ç–æ–±—ã –∫–æ–¥ –±—ã–ª –ø–æ–Ω—è—Ç–µ–Ω –¥–∂—É–Ω—É? –ü–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "Junior-Friendly Code":
‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª <200 —Å—Ç—Ä–æ–∫
‚úÖ –û–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚úÖ –ù–∏–∫–∞–∫–∏—Ö –º–æ–Ω—Å—Ç—Ä-—Ñ–∞–π–ª–æ–≤–ù–∞ —Ç–µ–∫—É—â–µ–π –Ω–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞?–Ø –ø–æ–Ω–∏–º–∞—é —á—Ç–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ —Å—É–ø–µ—Ä –ª–µ–≥–∫–∞—è –∑–∞–¥–∞—á–∞, —Ö–æ—Ç—è —è –ø—Ä–æ—Å–∏–ª —á—Ç–æ-—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ —ç—Ç–æ —Ç–æ —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ.–û—Ü–µ–Ω–∏ –∏–¥–µ—é –∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä—É–π. –ê —Ç–∞–∫ –∂–µ –≤ –∫–æ–Ω—Ü–µ –ø—Ä–µ–¥–ª–æ–∂–∏ –µ—â—ë —Å–≤–æ–∏—Ö –∏–¥–µ–π –∫–∞–∫ –¥–æ–∫—Ä—É—Ç–∏—Ç—å –∏ —á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å, –Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–ª–æ–∫–æ–ºShow lessüéØ –û–•–£–ï–ù–ù–ê–Ø –ò–î–ï–Ø! –°–ò–°–¢–ï–ú–ê–¢–ò–ó–ò–†–£–Æ!

‚úÖ –¢–´ –ê–ë–°–û–õ–Æ–¢–ù–û –ü–†–ê–í!
–ü–†–û–ë–õ–ï–ú–ê –°–ï–ô–ß–ê–°:
‚îú‚îÄ 2 –≤–∫–ª–∞–¥–∫–∏ AI (–±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ)
‚îú‚îÄ "Pepito, 1,800,000 IDR" - –ù–ï–¢ –ö–û–ù–¢–ï–ö–°–¢–ê
‚îú‚îÄ AI —Å–æ–≤–µ—Ç—ã generic ("—Ç—Ä–∞—Ç–∏—à—å –Ω–∞ 22% –±–æ–ª—å—à–µ")
‚îî‚îÄ –ù–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–∏

–¢–í–û–Ø –ò–î–ï–Ø:
‚îú‚îÄ 1 –≤–∫–ª–∞–¥–∫–∞ AI Analysis (—É–±—Ä–∞—Ç—å Training History)
‚îú‚îÄ –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–∫—É–ø–∫–∏ (—Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —á–µ–∫–∞!)
‚îú‚îÄ AI —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã –º–µ–∂–¥—É –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
‚îú‚îÄ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã ("–ø–æ–∫—É–ø–∞–π —Å–æ–∫ –≤ Moris!")
‚îî‚îÄ –ß–∞—Ç —Å AI –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–≠–¢–û –ì–ï–ù–ò–ê–õ–¨–ù–û! üî•

üìã –°–ò–°–¢–ï–ú–ê–¢–ò–ó–ê–¶–ò–Ø (–®–ê–ì –ó–ê –®–ê–ì–û–ú)
–≠–¢–ê–ü 1: –£–ë–†–ê–¢–¨ –õ–ò–®–ù–ï–ï (30 –ú–ò–ù–£–¢)
–ß–¢–û –î–ï–õ–ê–¢–¨:
1. –£–¥–∞–ª–∏—Ç—å "AI Training" –∏–∑ sidebar
2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å Training History –≤–Ω—É—Ç—Ä—å AI Analysis
3. –î–æ–±–∞–≤–∏—Ç—å Accordion:
   
   AI Analysis
   ‚îú‚îÄ Spending Analysis ‚úÖ
   ‚îú‚îÄ Financial Health Score ‚úÖ
   ‚îú‚îÄ Receipt OCR Scanner ‚úÖ
   ‚îî‚îÄ [‚ñº Advanced: Training History]  ‚Üê –°–ü–†–Ø–¢–ê–¢–¨ –°–Æ–î–ê

–†–ï–ó–£–õ–¨–¢–ê–¢:
‚îú‚îÄ –ß–∏—â–µ UI ‚úÖ
‚îî‚îÄ –û–¥–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö ‚úÖ

–í–†–ï–ú–Ø: 30 –º–∏–Ω—É—Ç
–§–ê–ô–õ–´: 
- sidebar.tsx (—É–¥–∞–ª–∏—Ç—å AI Training)
- ai-analysis-page.tsx (–¥–æ–±–∞–≤–∏—Ç—å accordion)

–≠–¢–ê–ü 2: –ö–û–ù–¢–ï–ö–°–¢ –ü–û–ö–£–ü–ö–ò (2-3 –ß–ê–°–ê)
2.1. –ë–ê–ó–ê –î–ê–ù–ù–´–•
sql-- –ù–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê: receiptItems
CREATE TABLE receipt_items (
  id SERIAL PRIMARY KEY,
  transaction_id INTEGER REFERENCES daily_transactions(id) CASCADE,
  
  -- –¢–æ–≤–∞—Ä
  item_name TEXT NOT NULL,
  normalized_name TEXT, -- "orange juice" (lowercase, no spaces)
  quantity DECIMAL(10,2),
  unit TEXT, -- 'pcs', 'kg', 'L'
  
  -- –¶–µ–Ω–∞
  price_per_unit DECIMAL(10,2) NOT NULL,
  total_price DECIMAL(10,2) NOT NULL,
  currency TEXT DEFAULT 'IDR',
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  merchant_name TEXT, -- "Moris Grocier"
  category TEXT, -- "Beverages"
  
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_receipt_items_normalized 
  ON receipt_items(normalized_name, merchant_name);
–†–ê–ó–ú–ï–†: 1 —Ç–∞–±–ª–∏—Ü–∞, –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ

2.2. OCR –° –ü–ê–†–°–ò–ù–ì–û–ú –¢–û–í–ê–†–û–í
–§–ê–ô–õ: server/services/ocr/receipt-parser.service.ts (~150 —Å—Ç—Ä–æ–∫)
typescript/**
 * –ü–∞—Ä—Å–∏—Ç —á–µ–∫ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
 */
export async function parseReceiptWithItems(
  imageBase64: string,
  userId: number
): Promise<ParsedReceipt> {
  
  // 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Claude API
  const prompt = `
    Parse this receipt and extract:
    1. Total amount
    2. Merchant name
    3. Date
    4. List of items with:
       - Item name
       - Quantity
       - Unit price
       - Total price
    
    Return JSON:
    {
      "total": 180000,
      "merchant": "Moris Grocier",
      "date": "2025-11-17",
      "items": [
        {
          "name": "Orange Juice 1L",
          "quantity": 2,
          "pricePerUnit": 32000,
          "totalPrice": 64000
        },
        ...
      ]
    }
  `;
  
  const response = await anthropic.messages.create({
    model: "claude-sonnet-4-20250514",
    messages: [{
      role: "user",
      content: [
        { type: "image", source: { type: "base64", data: imageBase64 } },
        { type: "text", text: prompt }
      ]
    }]
  });
  
  // 2. –ü–∞—Ä—Å–∏—Ç—å JSON
  const parsed = JSON.parse(response.content[0].text);
  
  // 3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è
  parsed.items = parsed.items.map(item => ({
    ...item,
    normalizedName: normalizeItemName(item.name)
  }));
  
  return parsed;
}

function normalizeItemName(name: string): string {
  return name
    .toLowerCase()
    .replace(/[0-9]+\s*(ml|l|kg|g|pcs)/gi, '') // —É–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã
    .replace(/[^a-z\s]/g, '') // —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã
    .trim();
}
–†–ê–ó–ú–ï–†: 150 —Å—Ç—Ä–æ–∫ ‚úÖ
JUNIOR-FRIENDLY: –î–∞ ‚úÖ

2.3. –°–û–•–†–ê–ù–ï–ù–ò–ï –¢–û–í–ê–†–û–í
–§–ê–ô–õ: server/repositories/receipt-items.repository.ts (~100 —Å—Ç—Ä–æ–∫)
typescriptexport class ReceiptItemsRepository extends BaseRepository {
  
  async createBulk(transactionId: number, items: ReceiptItem[]) {
    return await this.db
      .insert(receiptItems)
      .values(items.map(item => ({
        transactionId,
        itemName: item.name,
        normalizedName: item.normalizedName,
        quantity: item.quantity,
        pricePerUnit: item.pricePerUnit,
        totalPrice: item.totalPrice,
        merchantName: item.merchantName
      })))
      .returning();
  }
  
  async findByTransaction(transactionId: number) {
    return await this.db
      .select()
      .from(receiptItems)
      .where(eq(receiptItems.transactionId, transactionId));
  }
  
  async findSimilarItems(normalizedName: string, userId: number) {
    // –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏ —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    return await this.db
      .select()
      .from(receiptItems)
      .innerJoin(
        dailyTransactions,
        eq(receiptItems.transactionId, dailyTransactions.id)
      )
      .where(
        and(
          eq(receiptItems.normalizedName, normalizedName),
          eq(dailyTransactions.userId, userId)
        )
      )
      .orderBy(asc(receiptItems.pricePerUnit));
  }
}
–†–ê–ó–ú–ï–†: 100 —Å—Ç—Ä–æ–∫ ‚úÖ
–ú–û–î–£–õ–¨–ù–û: –î–∞ ‚úÖ

–≠–¢–ê–ü 3: AI –°–û–í–ï–¢–´ –ü–û –¶–ï–ù–ê–ú (2-3 –ß–ê–°–ê)
–§–ê–ô–õ: server/services/ai/price-comparison.service.ts (~180 —Å—Ç—Ä–æ–∫)
typescript/**
 * –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã –º–µ–∂–¥—É –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
 * –î–∞—ë—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
 */
export async function generatePriceRecommendations(
  userId: number
): Promise<PriceRecommendation[]> {
  
  // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —é–∑–µ—Ä–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞
  const items = await db
    .select()
    .from(receiptItems)
    .innerJoin(
      dailyTransactions,
      eq(receiptItems.transactionId, dailyTransactions.id)
    )
    .where(
      and(
        eq(dailyTransactions.userId, userId),
        gte(dailyTransactions.date, threeMonthsAgo)
      )
    );
  
  // 2. –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ normalizedName
  const grouped = groupBy(items, item => item.normalizedName);
  
  // 3. –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä—ã —Å —Ä–∞–∑–Ω–∏—Ü–µ–π —Ü–µ–Ω >20%
  const recommendations: PriceRecommendation[] = [];
  
  for (const [itemName, purchases] of Object.entries(grouped)) {
    if (purchases.length < 2) continue;
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ü–µ–Ω–µ
    const sorted = sortBy(purchases, 'pricePerUnit');
    const cheapest = sorted[0];
    const mostExpensive = sorted[sorted.length - 1];
    
    const priceDiff = mostExpensive.pricePerUnit - cheapest.pricePerUnit;
    const priceDiffPercent = (priceDiff / mostExpensive.pricePerUnit) * 100;
    
    if (priceDiffPercent >= 20) {
      recommendations.push({
        itemName: cheapest.itemName,
        normalizedName: itemName,
        cheapestMerchant: cheapest.merchantName,
        cheapestPrice: cheapest.pricePerUnit,
        expensiveMerchant: mostExpensive.merchantName,
        expensivePrice: mostExpensive.pricePerUnit,
        savingsAmount: priceDiff,
        savingsPercent: priceDiffPercent,
        recommendation: `Buy "${cheapest.itemName}" at ${cheapest.merchantName} instead of ${mostExpensive.merchantName}. Save ${formatCurrency(priceDiff)} (${priceDiffPercent.toFixed(0)}%)!`
      });
    }
  }
  
  // 4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏
  return recommendations.sort((a, b) => b.savingsAmount - a.savingsAmount);
}
–†–ê–ó–ú–ï–†: 180 —Å—Ç—Ä–æ–∫ ‚úÖ
–ö–û–ù–ö–†–ï–¢–ù–´–ï –°–û–í–ï–¢–´: –î–∞! üî•

–≠–¢–ê–ü 4: –ß–ê–¢ –° AI (4-6 –ß–ê–°–û–í)
4.1. –ë–ê–ó–ê –î–ê–ù–ù–´–•
sql-- –¢–ê–ë–õ–ò–¶–ê: aiChatMessages
CREATE TABLE ai_chat_messages (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) CASCADE,
  
  role TEXT NOT NULL, -- 'user' | 'assistant'
  content TEXT NOT NULL,
  
  -- –ö–æ–Ω—Ç–µ–∫—Å—Ç
  context_type TEXT, -- 'price_comparison' | 'spending_analysis' | 'general'
  context_data JSONB, -- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_chat_user ON ai_chat_messages(user_id, created_at DESC);

4.2. BACKEND CHAT SERVICE
–§–ê–ô–õ: server/services/ai/chat.service.ts (~200 —Å—Ç—Ä–æ–∫)
typescript/**
 * AI —á–∞—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export async function chatWithAI(
  userId: number,
  userMessage: string,
  apiKey: string
): Promise<ChatResponse> {
  
  // 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
  const history = await db
    .select()
    .from(aiChatMessages)
    .where(eq(aiChatMessages.userId, userId))
    .orderBy(desc(aiChatMessages.createdAt))
    .limit(10);
  
  // 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  const context = await buildFinancialContext(userId);
  
  // 3. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
  const systemPrompt = `
    You are a personal finance advisor for Budget Buddy app.
    
    User's financial context:
    - Monthly income: $${context.monthlyIncome}
    - Monthly expenses: $${context.monthlyExpenses}
    - Free capital: $${context.freeCapital}
    - Current balance: $${context.currentBalance}
    
    Price insights:
    ${context.priceRecommendations.map(r => 
      `- ${r.recommendation}`
    ).join('\n')}
    
    Answer user questions about their finances.
    Give concrete, actionable advice based on their data.
    Be friendly and helpful.
  `;
  
  // 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Claude
  const response = await anthropic.messages.create({
    model: "claude-sonnet-4-20250514",
    system: systemPrompt,
    messages: [
      ...history.reverse().map(msg => ({
        role: msg.role,
        content: msg.content
      })),
      {
        role: "user",
        content: userMessage
      }
    ]
  });
  
  const assistantMessage = response.content[0].text;
  
  // 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
  await db.insert(aiChatMessages).values([
    { userId, role: 'user', content: userMessage },
    { userId, role: 'assistant', content: assistantMessage }
  ]);
  
  return {
    message: assistantMessage,
    context: context.priceRecommendations
  };
}
–†–ê–ó–ú–ï–†: 200 —Å—Ç—Ä–æ–∫ ‚úÖ

4.3. FRONTEND CHAT UI
–§–ê–ô–õ: client/src/components/ai/ai-chat.tsx (~180 —Å—Ç—Ä–æ–∫)
typescript/**
 * AI Chat –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
 */
export function AIChat() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const sendMutation = useMutation({
    mutationFn: async (message: string) => {
      const response = await fetch('/api/ai/chat', {
        method: 'POST',
        body: JSON.stringify({ message })
      });
      return response.json();
    },
    onSuccess: (data) => {
      setMessages(prev => [
        ...prev,
        { role: 'user', content: input },
        { role: 'assistant', content: data.message }
      ]);
      setInput('');
    }
  });
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>Chat with AI Financial Advisor</CardTitle>
      </CardHeader>
      
      <CardContent>
        {/* –°–æ–æ–±—â–µ–Ω–∏—è */}
        <div className="space-y-4 mb-4 max-h-[500px] overflow-y-auto">
          {messages.map((msg, i) => (
            <div key={i} className={cn(
              "p-3 rounded-lg",
              msg.role === 'user' 
                ? "bg-blue-100 ml-auto max-w-[80%]" 
                : "bg-gray-100 mr-auto max-w-[80%]"
            )}>
              <p className="text-sm">{msg.content}</p>
            </div>
          ))}
          
          {isLoading && (
            <div className="bg-gray-100 p-3 rounded-lg animate-pulse">
              <p className="text-sm text-gray-500">AI is thinking...</p>
            </div>
          )}
        </div>
        
        {/* –ò–Ω–ø—É—Ç */}
        <div className="flex gap-2">
          <Input
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="Ask me anything about your finances..."
            onKeyPress={(e) => {
              if (e.key === 'Enter' && !isLoading) {
                sendMutation.mutate(input);
              }
            }}
          />
          <Button 
            onClick={() => sendMutation.mutate(input)}
            disabled={isLoading || !input.trim()}
          >
            Send
          </Button>
        </div>
        
        {/* –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã */}
        <div className="mt-4 flex flex-wrap gap-2">
          <Button variant="outline" size="sm"
            onClick={() => setInput("Where can I save money?")}
          >
            üí∞ Where can I save?
          </Button>
          <Button variant="outline" size="sm"
            onClick={() => setInput("What are the cheapest stores for groceries?")}
          >
            üõí Cheapest stores?
          </Button>
          <Button variant="outline" size="sm"
            onClick={() => setInput("Analyze my spending this month")}
          >
            üìä Monthly analysis
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

**–†–ê–ó–ú–ï–†:** 180 —Å—Ç—Ä–æ–∫ ‚úÖ  
**JUNIOR-FRIENDLY:** –î–∞ ‚úÖ

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê
```
AI Analysis Page:
‚îú‚îÄ [üí¨ Chat with AI] ‚Üê –ù–û–í–û–ï!
‚îú‚îÄ [üí∞ Price Recommendations] ‚Üê –ù–û–í–û–ï!
‚îÇ  ‚îî‚îÄ "Buy orange juice at Moris ($32k) not Pepito ($45k)"
‚îú‚îÄ [üìä Spending Analysis]
‚îú‚îÄ [üíö Financial Health Score]
‚îú‚îÄ [üì∏ Receipt OCR Scanner]
‚îî‚îÄ [‚ñº Advanced: Training History] ‚Üê –°–ü–†–Ø–¢–ê–ù–û

–ö–û–ù–¢–ï–ö–°–¢:
‚îî‚îÄ receipt_items —Ç–∞–±–ª–∏—Ü–∞
   ‚îî‚îÄ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —á–µ–∫–∞
   ‚îî‚îÄ AI —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã
   ‚îî‚îÄ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã!
```

---

## ‚è±Ô∏è –û–¶–ï–ù–ö–ê –í–†–ï–ú–ï–ù–ò
```
–≠–¢–ê–ü 1: –£–±—Ä–∞—Ç—å –ª–∏—à–Ω–µ–µ (30 –º–∏–Ω)
‚îú‚îÄ –£–¥–∞–ª–∏—Ç—å AI Training sidebar
‚îî‚îÄ –î–æ–±–∞–≤–∏—Ç—å accordion

–≠–¢–ê–ü 2: –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–∫—É–ø–∫–∏ (2-3—á)
‚îú‚îÄ –¢–∞–±–ª–∏—Ü–∞ receipt_items
‚îú‚îÄ OCR –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îî‚îÄ Repository

–≠–¢–ê–ü 3: AI —Å–æ–≤–µ—Ç—ã –ø–æ —Ü–µ–Ω–∞–º (2-3—á)
‚îú‚îÄ Price comparison service
‚îú‚îÄ UI –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îî‚îÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AI Analysis

–≠–¢–ê–ü 4: –ß–∞—Ç —Å AI (4-6—á)
‚îú‚îÄ Chat service backend
‚îú‚îÄ Chat UI frontend
‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–ò–¢–û–ì–û: 9-12 —á–∞—Å–æ–≤ (2 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)
```

---

## ‚úÖ JUNIOR-FRIENDLY?
```
‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫–∞–∂–¥—ã–π —Ñ–∞–π–ª <200 —Å—Ç—Ä–æ–∫)
‚úÖ –û–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ (parseReceiptWithItems, chatWithAI)
‚úÖ –ù–∏–∫–∞–∫–∏—Ö –º–æ–Ω—Å—Ç—Ä-—Ñ–∞–π–ª–æ–≤
‚úÖ –ü—Ä–æ—Å—Ç—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
‚úÖ –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ —Ö–∞–∫–æ–≤

–≠–¢–û –†–ï–ê–õ–ò–ó–£–ï–ú–û! üî•