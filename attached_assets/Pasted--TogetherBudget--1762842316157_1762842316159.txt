# üí± –ú–£–õ–¨–¢–ò–í–ê–õ–Æ–¢–ù–ê–Ø –°–ò–°–¢–ï–ú–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è
## üéØ –ß–¢–û –£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢
TogetherBudget –£–ñ–ï –∏–º–µ–µ—Ç –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—É—é —Å–∏—Å—Ç–µ–º—É! –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)
**–¢–∞–±–ª–∏—Ü–∞ `dailyTransactions`:**
- `amount` - –í–°–ï–ì–î–ê —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ USD
- `originalCurrency` - –∏—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞ (USD/RUB/IDR)
- `originalAmount` - –∏—Å—Ö–æ–¥–Ω–∞—è —Å—É–º–º–∞
- `exchangeRate` - –∫—É—Ä—Å –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è
**–¢–∞–±–ª–∏—Ü–∞ `wallets`:**
- `currency` - –≤–∞–ª—é—Ç–∞ –∫–æ—à–µ–ª—å–∫–∞ (USD/RUB/IDR)
- `balance` - –±–∞–ª–∞–Ω—Å –≤ —Ä–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç–µ –∫–æ—à–µ–ª—å–∫–∞
- `balanceUsd` - –∞–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤ USD (–£–ñ–ï –ï–°–¢–¨!)
**–¢–∞–±–ª–∏—Ü–∞ `recurringTransactions`:**
- `amount` - –≤ USD
- `originalCurrency`, `originalAmount`, `exchangeRate` - –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
**–¢–∞–±–ª–∏—Ü–∞ `userSettings`:**
- `preferredCurrency` - –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–∞—è –≤–∞–ª—é—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (USD/RUB/IDR)
### ‚úÖ Currency Service (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
**–§–∞–π–ª:** `server/currency-service.ts`
**–§—É–Ω–∫—Ü–∏–∏:**
- `convertRubToUsd(amount)` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è RUB ‚Üí USD
- `convertUsdToRub(amount)` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è USD ‚Üí RUB
- `convertIdrToUsd(amount)` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è IDR ‚Üí USD
- `getExchangeRateInfo()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í –ø–∞–º—è—Ç–∏ (Map)
- TTL: 1 —á–∞—Å
- Fallback –∫—É—Ä—Å—ã: RUB=83.75, IDR=16700
---
## üîß –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨/–î–û–ë–ê–í–ò–¢–¨
### 1. API endpoint –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤
**–°–æ–∑–¥–∞–π:** `server/routes.ts` (–¥–æ–±–∞–≤—å endpoint)
```typescript
// GET /api/exchange-rates - –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
router.get("/api/exchange-rates", async (req, res) => {
  try {
    const rates = await getExchangeRateInfo();
    res.json(rates);
  } catch (error) {
    res.status(500).json({ error: "Failed to fetch exchange rates" });
  }
});
// POST /api/wallets/refresh-rates - –æ–±–Ω–æ–≤–∏—Ç—å balanceUsd –≤–æ –≤—Å–µ—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö
router.post("/api/wallets/refresh-rates", requireAuth, async (req, res) => {
  try {
    const userId = req.user.id;
    
    // –ü–æ–ª—É—á–∏—Ç—å –∫–æ—à–µ–ª—å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const wallets = await storage.getWallets(userId);
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∫–∞–∂–¥—ã–π –∫–æ—à–µ–ª—ë–∫
    for (const wallet of wallets) {
      if (wallet.currency === "USD") {
        // USD –∫–æ—à–µ–ª—å–∫–∏ –Ω–µ –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
        await storage.updateWallet(wallet.id, {
          balanceUsd: wallet.balance
        }, userId);
        continue;
      }
      
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ USD
      let balanceUsd;
      if (wallet.currency === "RUB") {
        balanceUsd = await convertRubToUsd(parseFloat(wallet.balance));
      } else if (wallet.currency === "IDR") {
        balanceUsd = await convertIdrToUsd(parseFloat(wallet.balance));
      }
      
      // –û–±–Ω–æ–≤–∏—Ç—å balanceUsd
      await storage.updateWallet(wallet.id, {
        balanceUsd: balanceUsd.toString()
      }, userId);
    }
    
    res.json({ message: "Wallet rates updated successfully" });
  } catch (error) {
    res.status(500).json({ error: "Failed to refresh wallet rates" });
  }
});

2. Frontend: –°–µ–ª–µ–∫—Ç–æ—Ä –≤–∞–ª—é—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ö
–û–±–Ω–æ–≤–∏: client/src/components/TransactionForm.tsx

–î–æ–±–∞–≤—å –≤—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã:

const CURRENCIES = [
  { value: "USD", label: "$ USD", symbol: "$" },
  { value: "RUB", label: "‚ÇΩ RUB", symbol: "‚ÇΩ" },
  { value: "IDR", label: "Rp IDR", symbol: "Rp" }
];
// –í —Ñ–æ—Ä–º–µ –¥–æ–±–∞–≤—å:
<FormField
  control={form.control}
  name="currency"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Currency</FormLabel>
      <Select onValueChange={field.onChange} defaultValue={field.value}>
        <SelectTrigger data-testid="select-currency">
          <SelectValue placeholder="Select currency" />
        </SelectTrigger>
        <SelectContent>
          {CURRENCIES.map(curr => (
            <SelectItem key={curr.value} value={curr.value}>
              {curr.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </FormItem>
  )}
/>

3. Display: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å originalAmount + –≤–∞–ª—é—Ç—É
–í —Å–ø–∏—Å–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–π:

<div>
  <span className="font-semibold">${transaction.amount}</span>
  {transaction.originalCurrency !== "USD" && (
    <span className="text-sm text-gray-500 ml-2">
      ({transaction.originalAmount} {transaction.originalCurrency})
    </span>
  )}
</div>

4. Wallet Card: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–µ –≤–∞–ª—é—Ç—ã
<div>
  <span className="text-2xl font-bold">
    {wallet.balance} {wallet.currency}
  </span>
  {wallet.currency !== "USD" && (
    <span className="text-gray-500 text-sm block">
      ‚âà ${wallet.balanceUsd}
    </span>
  )}
</div>

5. Settings: –≤—ã–±–æ—Ä preferredCurrency
–î–æ–±–∞–≤—å –≤ Settings:

<FormField
  control={form.control}
  name="preferredCurrency"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Preferred Currency</FormLabel>
      <FormDescription>
        Your default currency for new transactions
      </FormDescription>
      <Select onValueChange={field.onChange} defaultValue={field.value}>
        <SelectTrigger>
          <SelectValue />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="USD">$ USD</SelectItem>
          <SelectItem value="RUB">‚ÇΩ RUB</SelectItem>
          <SelectItem value="IDR">Rp IDR</SelectItem>
        </SelectContent>
      </Select>
    </FormItem>
  )}
/>

üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
–ü—Ä–æ–≤–µ—Ä—å —ç—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ RUB:

–í–≤–µ—Å—Ç–∏ 1000 RUB
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ amount = ~11.94 USD (–ø—Ä–∏ –∫—É—Ä—Å–µ 83.75)
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ originalAmount = 1000, originalCurrency = "RUB"
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –≤ IDR:

–°–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª—ë–∫ —Å 1,000,000 IDR
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ balanceUsd = ~60 USD (–ø—Ä–∏ –∫—É—Ä—Å–µ 16700)
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤:

–í—ã–∑–≤–∞—Ç—å POST /api/wallets/refresh-rates
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ balanceUsd –æ–±–Ω–æ–≤–∏–ª—Å—è
Dashboard –º–µ—Ç—Ä–∏–∫–∏:

–í—Å–µ —Ä–∞—Å—á—ë—Ç—ã (income, expenses, free capital) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ USD
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ preferredCurrency –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–ï –°–û–ó–î–ê–í–ê–ô
‚ùå –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —Ç–∞–±–ª–∏—Ü—É exchange_rates (–∏—Å–ø–æ–ª—å–∑—É–π –∫—ç—à –≤ –ø–∞–º—è—Ç–∏)
‚ùå –ù–ï –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–π dailyTransactions –≤ transactions
‚ùå –ù–ï –º–µ–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É amount (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ USD)
‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ schema (–≤—Å–µ —É–∂–µ –µ—Å—Ç—å!)
üìã CHECKLIST
[ ] GET /api/exchange-rates endpoint
[ ] POST /api/wallets/refresh-rates endpoint  
[ ] Currency selector –≤ TransactionForm
[ ] Currency selector –≤ WalletForm
[ ] Display originalAmount –≤ transaction lists
[ ] Display both currencies –≤ wallet cards
[ ] Preferred currency –≤ Settings
[ ] Test: create RUB transaction
[ ] Test: create IDR wallet
[ ] Test: refresh wallet rates
[ ] Test: dashboard metrics –≤ USD

üéØ –†–ï–ó–£–õ–¨–¢–ê–¢
–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –°–í–û–ï–ô –≤–∞–ª—é—Ç–µ
‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ USD
‚úÖ –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (–≤ USD)
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–∞–ª—é—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (originalAmount + –∫—É—Ä—Å)
---
## üí° –ú–û–ò –°–û–í–ï–¢–´:
**–î–ª—è Replit –∞–≥–µ–Ω—Ç–∞:**
1. **–ù–µ –¥–∞–≤–∞–π –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥** - –¥–∞–π –ò–ù–°–¢–†–£–ö–¶–ò–ò —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å
2. **–£–∫–∞–∂–∏ –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï —Ñ–∞–π–ª—ã** - —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª –¥—É–±–ª–∏–∫–∞—Ç—ã
3. **–î–∞–π checklist** - —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –∑–Ω–∞–ª —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. **–Ø–≤–Ω–æ —Å–∫–∞–∂–∏ —á—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏ –æ—à–∏–±–∫–∏