ะะะะะะะข C: ะฃะะะะฏ ะะะขะะะะะะะะฆะะฏ (ะะฃะงะจะะ)
typescript// ะะพะฑะฐะฒะธัั ะฒ system prompt ัะฟะธัะพะบ ะบะฐัะตะณะพัะธะน:

const systemPrompt = `
You are a financial assistant.

User has these categories:
${categories.map(c => `- ${c.name} (${c.type})`).join('\n')}

When adding transaction:
1. Try to guess category from description
2. "ัะตััะพัะฐะฝ", "ะบะฐัะต", "ะตะดะฐ ะฒะฝะต ะดะพะผะฐ" โ "ะะตััะพัะฐะฝั"
3. "ะฟัะพะดัะบัั", "ะผะฐะณะฐะทะธะฝ", "ััะฟะตัะผะฐัะบะตั" โ "ะัะพะดัะบัั"
4. "ัะฐะบัะธ", "uber", "ััะฐะฝัะฟะพัั" โ "ะขัะฐะฝัะฟะพัั"
5. If unsure โ ask user to specify
`;

// AI ะฑัะดะตั ัะผะฝะตะต ะฒัะฑะธัะฐัั ะบะฐัะตะณะพัะธะธ!
```

---

## 2๏ธโฃ ะงะขะ ะะะะะงะะฎะข ะะะ ะะะะะะ?
```
[โ Execute]  โ  ะะซะะะะะะขะฌ ะะะะกะขะะะ
                AI ัะพะทะดะฐัั ััะฐะฝะทะฐะบัะธั ะฒ ะะ
                ะะฐััะพะด 220,000 ะฑัะดะตั ะดะพะฑะฐะฒะปะตะฝ

[โ Cancel]   โ  ะะขะะะะะขะฌ
                ะขัะฐะฝะทะฐะบัะธั ะะ ะฑัะดะตั ัะพะทะดะฐะฝะฐ
                ะะตัะฝััััั ะฒ ัะฐั
```

---

## 3๏ธโฃ ะะะ ะะขะะะะะะขะะะะะะขะฌ ะะะะะะะขะะซ?
```
ะกะะะงะะก: ะะะะฌะะฏ โ

ะัะปะธ ัะพัะตัั ะธะทะผะตะฝะธัั:
1. ะะฐะถะผะธ [Cancel]
2. ะะฐะฟะธัะธ ะทะฐะฝะพะฒะพ ะฟัะฐะฒะธะปัะฝะพ:
   "ะะพะฑะฐะฒั ัะฐััะพะด 220ะบ ะฝะฐ ะะตััะพัะฐะฝั, Secret Spot"

๐ ะะะ ะกะะะะะขะฌ ะะะะะะขะะะะะะะะ?
ะะะะะะะขะฌ ะะะะะะฃ [โ๏ธ EDIT]
typescript// ะ confirmation-card.tsx

<ConfirmationButtons
  onConfirm={handleConfirm}
  onCancel={onCancel}
  onEdit={() => setEditMode(true)} // โ ะะะะะฏ ะะะะะะ
  loading={loading}
/>

// ะะพะณะดะฐ edit mode:
{editMode ? (
  <form>
    <input 
      name="amount" 
      defaultValue={params.amount}
    />
    <input 
      name="description" 
      defaultValue={params.description}
    />
    <select name="category">
      <option>ะะตััะพัะฐะฝั</option>
      <option>ะัะพะดัะบัั</option>
    </select>
    
    <button onClick={saveEdits}>
      ๐พ ะกะพััะฐะฝะธัั
    </button>
  </form>
) : (
  <ParametersView params={params} />
)}
```

---

## ๐ ะงะขะ ะกะะะะะขะฌ ะกะะะงะะก?

### **IMMEDIATE FIX (ะะซะกะขะะ):**
```
1. ะะพะฑะฐะฒะธัั ะบะฐัะตะณะพัะธะธ ะฒ system prompt:

const categories = await repositories.categories.findByUser(userId);

const systemPrompt = `
You are a financial assistant.

Available categories:
${categories.map(c => `- ${c.name}`).join('\n')}

When user mentions:
- "ัะตััะพัะฐะฝ", "ะบะฐัะต", "ะตะดะฐ" โ use "ะะตััะพัะฐะฝั"
- "ะฟัะพะดัะบัั", "ะผะฐะณะฐะทะธะฝ" โ use "ะัะพะดัะบัั"  
- "ัะฐะบัะธ", "uber" โ use "ะขัะฐะฝัะฟะพัั"

Always try to detect category from description.
`;

ะะะะฃะะฌะขะะข:
User: "ะตะดะฐ ะฒ Secret Spot 220ะบ"
AI: category: "ะะตััะพัะฐะฝั" โ
```

---

### **BETTER UX (ะกะะะะะะกะะะงะะ):**
```
2. ะะพะฑะฐะฒะธัั dropdown ะฒ confirmation card:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Add Transaction             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Amount: 220000              โ
โ Description: Secret Spot    โ
โ Type: expense               โ
โ Category: [ะะตััะพัะฐะฝั โผ]     โ โ DROPDOWN!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [โ Execute] [โ Cancel]      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// ะ ConfirmationCard:
<select 
  value={selectedCategory}
  onChange={(e) => setSelectedCategory(e.target.value)}
>
  {categories.map(c => (
    <option key={c.id} value={c.name}>
      {c.icon} {c.name}
    </option>
  ))}
</select>
```

---

### **PERFECT SOLUTION (ะะะะะะกะะะงะะ):**
```
3. ML-ะบะฐัะตะณะพัะธะทะฐัะธั (ะบะฐะบ ั ะะทะตะฝ-ะผะฐะฝะธ):

// ะะพะฑะฐะฒะธัั tool: suggest_category
{
  name: 'suggest_category',
  description: 'Suggest category based on description',
  input_schema: {
    properties: {
      description: { type: 'string' }
    }
  }
}

// Handler:
async function suggestCategory(description: string) {
  // ML model ะธะปะธ rule-based
  if (description.includes('ัะตััะพัะฐะฝ')) return 'ะะตััะพัะฐะฝั';
  if (description.includes('ะฟัะพะดัะบัั')) return 'ะัะพะดัะบัั';
  // ...
}

// AI ะธัะฟะพะปัะทัะตั:
User: "ะตะดะฐ ะฒ Secret Spot"
AI: suggest_category("ะตะดะฐ ะฒ Secret Spot")
โ "ะะตััะพัะฐะฝั"
AI: add_transaction(category="ะะตััะพัะฐะฝั") โ
```

---

## ๐ ะะะะะงะ ะะะฏ REPLIT (IMMEDIATE FIX)
```
ะฃะปัััะธ ะพะฟัะตะดะตะปะตะฝะธะต ะบะฐัะตะณะพัะธะน ะฒ AI Assistant

ะะะะะะะะ:
AI ะฝะต ะพะฟัะตะดะตะปัะตั ะบะฐัะตะณะพัะธั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะท ะพะฟะธัะฐะฝะธั.

ะะะจะะะะ:
ะะพะฑะฐะฒะธัั ัะฟะธัะพะบ ะบะฐัะตะณะพัะธะน ัะทะตัะฐ ะฒ system prompt ั ะฟัะฐะฒะธะปะฐะผะธ.

ะะะะะะะขะฌ server/ai/chat-with-tools.ts:

---
export async function chatWithTools(
  message: string,
  userId: number
) {
  const settings = await repositories.settings.findByUser(userId);
  
  if (!settings?.anthropicApiKey) {
    throw new Error('API key not configured');
  }
  
  // ะะพะปััะธัั ะบะฐัะตะณะพัะธะธ ัะทะตัะฐ
  const categories = await repositories.categories.findByUser(userId);
  
  // System prompt ั ะบะฐัะตะณะพัะธัะผะธ
  const systemPrompt = `You are a financial assistant for Budget Buddy.

User ID: ${userId}

Available transaction categories:
${categories.map(c => `- ${c.name} (${c.type})`).join('\n')}

Smart category detection rules:
- "ัะตััะพัะฐะฝ", "ะบะฐัะต", "ะตะดะฐ ะฒะฝะต ะดะพะผะฐ", "restaurant" โ "ะะตััะพัะฐะฝั"
- "ะฟัะพะดัะบัั", "ะผะฐะณะฐะทะธะฝ", "ััะฟะตัะผะฐัะบะตั", "groceries" โ "ะัะพะดัะบัั"
- "ัะฐะบัะธ", "uber", "ััะฐะฝัะฟะพัั", "taxi" โ "ะขัะฐะฝัะฟะพัั"
- "ัะฐะทะฒะปะตัะตะฝะธั", "ะบะธะฝะพ", "entertainment" โ "ะะฐะทะฒะปะตัะตะฝะธั"

When user adds transaction:
1. Always try to detect category from description
2. Use exact category name from the list above
3. If category not in list โ leave it empty (user will choose)

Example:
User: "ะตะดะฐ ะฒ Secret Spot 220000"
You: add_transaction(description="ะตะดะฐ ะฒ Secret Spot", category="ะะตััะพัะฐะฝั")
`;

  const anthropic = new Anthropic({ 
    apiKey: settings.anthropicApiKey 
  });
  
  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    max_tokens: 4096,
    system: systemPrompt, // โ ะก ะบะฐัะตะณะพัะธัะผะธ!
    tools: ANTHROPIC_TOOLS,
    messages: [{ role: 'user', content: message }]
  });
  
  return response;
}
---

ะะะะฃะะฌะขะะข:
โ AI ะฒะธะดะธั ัะฟะธัะพะบ ะบะฐัะตะณะพัะธะน ัะทะตัะฐ
โ AI ะทะฝะฐะตั ะฟัะฐะฒะธะปะฐ ะพะฟัะตะดะตะปะตะฝะธั
โ AI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะดััะฐะฒะปัะตั category
โ ะัะปะธ ะฝะต ัะฒะตัะตะฝ โ ะพััะฐะฒะปัะตั ะฟััััะผ

ะขะะกะข:
User: "ะตะดะฐ ะฒ ัะตััะพัะฐะฝะต 1000 ััะฑะปะตะน"
Expected: category = "ะะตััะพัะฐะฝั" (ะตัะปะธ ัะฐะบะฐั ะตััั ั ัะทะตัะฐ)
```

---

## ๐ก ะะะ ะะะะะะฃ EDIT (ะะะฆะะะะะะฌะะ)
```
ะัะปะธ ัะพัะตัั ะดะพะฑะฐะฒะธัั ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต:

ะะะะะงะ:
ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบั [โ๏ธ Edit] ะฒ confirmation card

ะะะะะะะขะฌ confirmation-card.tsx:

1. ะะพะฑะฐะฒะธัั edit mode state
2. ะะพะบะฐะทัะฒะฐัั ัะพัะผั ะฒะผะตััะพ ะฟะฐัะฐะผะตััะพะฒ
3. ะะฝะพะฟะบะธ: [Save] [Cancel edit]

ะญัะพ ัะปัััะธั UX, ะฝะพ ะฝะต ะบัะธัะธัะฝะพ.
ะกะตะนัะฐั ะผะพะถะฝะพ ะฟัะพััะพ ะฝะฐะถะฐัั Cancel ะธ ะฝะฐะฟะธัะฐัั ะทะฐะฝะพะฒะพ.
```

---

## ๐ฏ ะะขะะะ
```
ะะะะะะก 1: ะะพัะตะผั ะฝะต ะพะฟัะตะดะตะปะธะป ะบะฐัะตะณะพัะธั?
ะะขะะะข: AI ะฝะต ะฒะธะดะธั ัะฟะธัะพะบ ะบะฐัะตะณะพัะธะน + ะฝะตั ะฟัะฐะฒะธะป

ะะะะะะก 2: ะงัะพ ะพะทะฝะฐัะฐัั ะบะฝะพะฟะบะธ?
ะะขะะะข: Execute = ัะพะทะดะฐัั, Cancel = ะพัะผะตะฝะธัั

ะะะะะะก 3: ะะฐะบ ัะตะดะฐะบัะธัะพะฒะฐัั?
ะะขะะะข: ะกะตะนัะฐั ะฝะตะปัะทั, ะฝัะถะฝะพ Cancel ะธ ะฝะฐะฟะธัะฐัั ะทะฐะฝะพะฒะพ
       ะะปะธ ะดะพะฑะฐะฒะธัั Edit ะบะฝะพะฟะบั (TODO)

IMMEDIATE FIX:
โโ ะะพะฑะฐะฒะธัั ะบะฐัะตะณะพัะธะธ ะฒ system prompt
โโ AI ััะฐะฝะตั ัะผะฝะตะต! โ