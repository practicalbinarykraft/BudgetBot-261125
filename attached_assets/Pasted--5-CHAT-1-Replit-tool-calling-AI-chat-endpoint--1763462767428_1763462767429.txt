üéØ –®–ê–ì 5: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í CHAT (1 –î–ï–ù–¨)
–ó–∞–¥–∞—á–∞ –¥–ª—è Replit:
–ü–æ–¥–∫–ª—é—á–∏ tool calling –∫ AI chat endpoint

–û–ë–ù–û–í–ò–¢–¨ server/routes/ai.routes.ts:

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É tool calling –≤ /api/ai/chat endpoint:

1. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
   - –í—ã–∑–≤–∞—Ç—å chatWithTools()
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ tool_use –≤ –æ—Ç–≤–µ—Ç–µ
   - –ï—Å–ª–∏ –µ—Å—Ç—å:
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å requiresConfirmation
     * –ï—Å–ª–∏ false ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É
     * –ï—Å–ª–∏ true ‚Üí –≤–µ—Ä–Ω—É—Ç—å confirmation –∑–∞–ø—Ä–æ—Å

2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π endpoint /api/ai/confirm-tool:
   - –ü–æ–ª—É—á–∏—Ç—å action, params, toolUseId
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å tool —á–µ—Ä–µ–∑ executeTool()
   - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

–ü–°–ï–í–î–û–ö–û–î:

router.post('/api/ai/chat', async (req, res) => {
  const { message } = req.body;
  const userId = req.user!.id;
  
  try {
    // –í—ã–∑–≤–∞—Ç—å Claude —Å tools
    const response = await chatWithTools(message, userId);
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–µ–Ω –ª–∏ tool
    const toolUse = response.content.find(c => c.type === 'tool_use');
    
    if (toolUse) {
      const tool = TOOLS.find(t => t.name === toolUse.name);
      
      if (!tool.requiresConfirmation) {
        // –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É (READ –æ–ø–µ—Ä–∞—Ü–∏—è)
        const result = await executeTool(toolUse.name, toolUse.input, userId);
        
        // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        // TODO: implement continuation
        
        return res.json({
          type: 'message',
          content: 'Tool executed...'
        });
      }
      
      // –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (WRITE –æ–ø–µ—Ä–∞—Ü–∏—è)
      return res.json({
        type: 'tool_confirmation',
        action: toolUse.name,
        params: toolUse.input,
        toolUseId: toolUse.id
      });
    }
    
    // –û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ tools
    const textContent = response.content.find(c => c.type === 'text');
    return res.json({
      type: 'message',
      content: textContent?.text || 'No response'
    });
    
  } catch (error: any) {
    return res.status(500).json({ 
      error: error.message 
    });
  }
});

router.post('/api/ai/confirm-tool', async (req, res) => {
  const { action, params, toolUseId } = req.body;
  const userId = req.user!.id;
  
  try {
    // –í—ã–ø–æ–ª–Ω–∏—Ç—å tool
    const result = await executeTool(action, params, userId);
    
    if (!result.success) {
      return res.status(400).json({ error: result.error });
    }
    
    // TODO: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥ —Å Claude
    // –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å tool_result –æ–±—Ä–∞—Ç–Ω–æ –≤ Claude
    
    return res.json({
      type: 'message',
      content: `‚úÖ –î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! ${JSON.stringify(result.data)}`
    });
    
  } catch (error: any) {
    return res.status(500).json({ error: error.message });
  }
});

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ requiresConfirmation
- READ tools –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É
- WRITE tools —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è