# üìã –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù: AI AGENT –° TOOL CALLING

---

## üéØ –û–ë–©–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø

```
–ü–†–ò–ù–¶–ò–ü: –ö–∞–∂–¥—ã–π —à–∞–≥ = –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è = –æ–¥–∏–Ω —Ñ–∞–π–ª

–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
‚îú‚îÄ –ö–∞–∂–¥—ã–π —à–∞–≥ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ
‚îú‚îÄ Rollback –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å
‚îú‚îÄ –ù–µ —Ç—Ä–æ–≥–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
‚îî‚îÄ –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Ä—è–¥–æ–º

–ú–û–î–£–õ–¨–ù–û–°–¢–¨:
‚îî‚îÄ –í—Å–µ —Ñ–∞–π–ª—ã <200 —Å—Ç—Ä–æ–∫
‚îî‚îÄ –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞
‚îî‚îÄ –û–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
```

---

## üìä –í–°–ï–ì–û: 8 –®–ê–ì–û–í (5-7 –î–ù–ï–ô)

```
–®–ê–ì 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 –¥–µ–Ω—å)
–®–ê–ì 2: –ü–µ—Ä–≤—ã–π Tool (0.5 –¥–Ω—è)
–®–ê–ì 3: Tool Handlers (0.5 –¥–Ω—è)
–®–ê–ì 4: UI –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π (1 –¥–µ–Ω—å)
–®–ê–ì 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Chat (1 –¥–µ–Ω—å)
–®–ê–ì 6: –û—Å—Ç–∞–ª—å–Ω—ã–µ Tools (1 –¥–µ–Ω—å)
–®–ê–ì 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 –¥–µ–Ω—å)
–®–ê–ì 8: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (0.5 –¥–Ω—è)
```

---

## üîß –®–ê–ì 1: –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê (1 –î–ï–ù–¨)

### **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### **–§–∞–π–ª—ã (3 —Ñ–∞–π–ª–∞, ~150 —Å—Ç—Ä–æ–∫):**

```
server/ai/
‚îú‚îÄ tools.ts           (50 —Å—Ç—Ä–æ–∫)  - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è tools
‚îú‚îÄ tool-executor.ts   (50 —Å—Ç—Ä–æ–∫)  - executor –¥–ª—è tools
‚îî‚îÄ tool-types.ts      (50 —Å—Ç—Ä–æ–∫)  - TypeScript —Ç–∏–ø—ã
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// 1. server/ai/tool-types.ts (50 —Å—Ç—Ä–æ–∫)
export type ToolName = 
  | 'create_category'
  | 'add_transaction'
  | 'get_balance';

export interface Tool {
  name: ToolName;
  description: string;
  input_schema: {
    type: 'object';
    properties: Record<string, any>;
    required: string[];
  };
}

export interface ToolResult {
  success: boolean;
  data?: any;
  error?: string;
}

export interface ToolConfirmation {
  action: ToolName;
  params: Record<string, any>;
  preview: string;
}

// 2. server/ai/tools.ts (50 —Å—Ç—Ä–æ–∫)
import { Tool } from './tool-types';

export const TOOLS: Tool[] = [
  {
    name: 'get_balance',
    description: 'Get current user balance and capital',
    input_schema: {
      type: 'object',
      properties: {},
      required: []
    }
  }
  // –ü–æ–∫–∞ –û–î–ò–ù tool –¥–ª—è —Ç–µ—Å—Ç–∞
];

// 3. server/ai/tool-executor.ts (50 —Å—Ç—Ä–æ–∫)
import { ToolName, ToolResult } from './tool-types';

export async function executeTool(
  toolName: ToolName,
  params: Record<string, any>,
  userId: number
): Promise<ToolResult> {
  try {
    switch (toolName) {
      case 'get_balance':
        // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞
        return {
          success: true,
          data: { balance: 10000 }
        };
      
      default:
        return {
          success: false,
          error: 'Unknown tool'
        };
    }
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
```

### **–¢–µ—Å—Ç:**
```
‚úÖ –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
‚úÖ TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ LSP
‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –Ω–µ —Ç—Ä–æ–Ω—É—Ç
```

---

## üîß –®–ê–ì 2: –ü–ï–†–í–´–ô TOOL (0.5 –î–ù–Ø)

### **–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–±–æ—Ç–∞—é—â–∏–π tool (get_balance)

### **–§–∞–π–ª—ã (1 —Ñ–∞–π–ª, ~50 —Å—Ç—Ä–æ–∫):**

```
server/ai/
‚îî‚îÄ handlers/
   ‚îî‚îÄ balance-handler.ts (50 —Å—Ç—Ä–æ–∫)
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// server/ai/handlers/balance-handler.ts (50 —Å—Ç—Ä–æ–∫)
import { repositories } from '../../repositories';
import { ToolResult } from '../tool-types';

export async function handleGetBalance(
  userId: number
): Promise<ToolResult> {
  try {
    // –ü–æ–ª—É—á–∏—Ç—å –∫–æ—à–µ–ª—å–∫–∏
    const wallets = await repositories.wallets.findByUser(userId);
    
    // –ü–æ—Å—á–∏—Ç–∞—Ç—å –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å
    const totalBalance = wallets.reduce(
      (sum, wallet) => sum + wallet.balanceUsd,
      0
    );
    
    return {
      success: true,
      data: {
        balance: totalBalance,
        wallets: wallets.length,
        currency: 'USD'
      }
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}

// –û–±–Ω–æ–≤–∏—Ç—å tool-executor.ts:
case 'get_balance':
  return await handleGetBalance(userId);
```

### **–¢–µ—Å—Ç:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π endpoint:
router.get('/api/ai/test-tool', async (req, res) => {
  const result = await executeTool('get_balance', {}, req.user!.id);
  res.json(result);
});

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
curl /api/ai/test-tool
// ‚Üí { success: true, data: { balance: 10000, ... } }
```

---

## üîß –®–ê–ì 3: TOOL HANDLERS (0.5 –î–ù–Ø)

### **–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å handlers –¥–ª—è –≤—Å–µ—Ö –±–∞–∑–æ–≤—ã—Ö tools

### **–§–∞–π–ª—ã (3 —Ñ–∞–π–ª–∞, ~150 —Å—Ç—Ä–æ–∫):**

```
server/ai/handlers/
‚îú‚îÄ category-handler.ts     (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ transaction-handler.ts  (50 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ index.ts               (50 —Å—Ç—Ä–æ–∫) - exports
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// 1. category-handler.ts (50 —Å—Ç—Ä–æ–∫)
export async function handleCreateCategory(
  userId: number,
  params: { name: string; type: string; icon?: string; color?: string }
): Promise<ToolResult> {
  const category = await repositories.categories.create({
    userId,
    ...params
  });
  
  return {
    success: true,
    data: category
  };
}

// 2. transaction-handler.ts (50 —Å—Ç—Ä–æ–∫)
export async function handleAddTransaction(
  userId: number,
  params: { amount: number; description: string; category: string; type: string }
): Promise<ToolResult> {
  const transaction = await repositories.transactions.create({
    userId,
    ...params,
    date: new Date().toISOString()
  });
  
  return {
    success: true,
    data: transaction
  };
}

// 3. index.ts (50 —Å—Ç—Ä–æ–∫)
export { handleGetBalance } from './balance-handler';
export { handleCreateCategory } from './category-handler';
export { handleAddTransaction } from './transaction-handler';

// 4. –û–±–Ω–æ–≤–∏—Ç—å tools.ts (–¥–æ–±–∞–≤–∏—Ç—å 2 –Ω–æ–≤—ã—Ö tool)
{
  name: 'create_category',
  description: 'Create new transaction category',
  input_schema: {
    type: 'object',
    properties: {
      name: { type: 'string' },
      type: { type: 'string', enum: ['income', 'expense'] },
      icon: { type: 'string' },
      color: { type: 'string' }
    },
    required: ['name', 'type']
  }
},
{
  name: 'add_transaction',
  description: 'Add new transaction',
  input_schema: {
    type: 'object',
    properties: {
      amount: { type: 'number' },
      description: { type: 'string' },
      category: { type: 'string' },
      type: { type: 'string', enum: ['income', 'expense'] }
    },
    required: ['amount', 'description', 'type']
  }
}
```

### **–¢–µ—Å—Ç:**
```
curl /api/ai/test-tool?tool=create_category
curl /api/ai/test-tool?tool=add_transaction
```

---

## üîß –®–ê–ì 4: UI –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ô (1 –î–ï–ù–¨)

### **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

### **–§–∞–π–ª—ã (3 —Ñ–∞–π–ª–∞, ~180 —Å—Ç—Ä–æ–∫):**

```
client/src/components/ai-chat-sidebar/
‚îú‚îÄ confirmation-card.tsx     (80 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ action-preview.tsx        (50 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ confirmation-buttons.tsx  (50 —Å—Ç—Ä–æ–∫)
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// 1. action-preview.tsx (50 —Å—Ç—Ä–æ–∫)
interface ActionPreviewProps {
  action: string;
  params: Record<string, any>;
}

export function ActionPreview({ action, params }: ActionPreviewProps) {
  const getIcon = () => {
    switch (action) {
      case 'create_category': return 'üìÅ';
      case 'add_transaction': return 'üí∏';
      case 'get_balance': return 'üí∞';
      default: return 'ü§ñ';
    }
  };
  
  const getTitle = () => {
    switch (action) {
      case 'create_category': return '–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
      case 'add_transaction': return '–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é';
      case 'get_balance': return '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å';
    }
  };
  
  return (
    <div className="flex items-center gap-3">
      <div className="w-10 h-10 rounded-full bg-blue-500 
                      flex items-center justify-center text-xl">
        {getIcon()}
      </div>
      <div>
        <h4 className="font-semibold">{getTitle()}</h4>
        <p className="text-sm text-gray-500">
          {Object.keys(params).length} –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        </p>
      </div>
    </div>
  );
}

// 2. confirmation-buttons.tsx (50 —Å—Ç—Ä–æ–∫)
interface ConfirmationButtonsProps {
  onConfirm: () => void;
  onCancel: () => void;
  loading?: boolean;
}

export function ConfirmationButtons({ 
  onConfirm, 
  onCancel, 
  loading 
}: ConfirmationButtonsProps) {
  return (
    <div className="flex gap-2">
      <button
        onClick={onConfirm}
        disabled={loading}
        className="flex-1 p-2 bg-blue-500 text-white rounded-lg
                   hover:bg-blue-600 disabled:opacity-50"
      >
        {loading ? '‚è≥ –í—ã–ø–æ–ª–Ω—è—é...' : '‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å'}
      </button>
      <button
        onClick={onCancel}
        disabled={loading}
        className="px-4 p-2 border rounded-lg hover:bg-gray-100"
      >
        ‚ùå –û—Ç–º–µ–Ω–∞
      </button>
    </div>
  );
}

// 3. confirmation-card.tsx (80 —Å—Ç—Ä–æ–∫)
interface ConfirmationCardProps {
  action: string;
  params: Record<string, any>;
  onConfirm: () => void;
  onCancel: () => void;
}

export function ConfirmationCard({
  action,
  params,
  onConfirm,
  onCancel
}: ConfirmationCardProps) {
  const [loading, setLoading] = useState(false);
  
  const handleConfirm = async () => {
    setLoading(true);
    await onConfirm();
    setLoading(false);
  };
  
  return (
    <div className="p-4 border-2 border-blue-500 rounded-xl
                    bg-blue-50 dark:bg-blue-900/20 space-y-3">
      <ActionPreview action={action} params={params} />
      
      {/* Parameters */}
      <div className="bg-white dark:bg-gray-800 p-3 rounded-lg text-sm">
        {Object.entries(params).map(([key, value]) => (
          <div key={key} className="flex justify-between py-1">
            <span className="text-gray-500">{key}:</span>
            <span className="font-medium">{String(value)}</span>
          </div>
        ))}
      </div>
      
      <ConfirmationButtons
        onConfirm={handleConfirm}
        onCancel={onCancel}
        loading={loading}
      />
    </div>
  );
}
```

### **–¢–µ—Å—Ç:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ stories –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:
<ConfirmationCard
  action="create_category"
  params={{ name: "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã", type: "expense" }}
  onConfirm={() => console.log('confirmed')}
  onCancel={() => console.log('cancelled')}
/>
```

---

## üîß –®–ê–ì 5: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í CHAT (1 –î–ï–ù–¨)

### **–¶–µ–ª—å:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å tool calling –∫ AI chat endpoint

### **–§–∞–π–ª—ã (2 —Ñ–∞–π–ª–∞, ~150 —Å—Ç—Ä–æ–∫):**

```
server/routes/
‚îî‚îÄ ai.routes.ts (–æ–±–Ω–æ–≤–∏—Ç—å, +100 —Å—Ç—Ä–æ–∫)

server/ai/
‚îî‚îÄ chat-with-tools.ts (50 —Å—Ç—Ä–æ–∫) - –Ω–æ–≤—ã–π
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// 1. chat-with-tools.ts (50 —Å—Ç—Ä–æ–∫)
import Anthropic from '@anthropic-ai/sdk';
import { TOOLS } from './tools';

export async function chatWithTools(
  message: string,
  apiKey: string,
  systemPrompt: string
) {
  const anthropic = new Anthropic({ apiKey });
  
  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    max_tokens: 4096,
    system: systemPrompt,
    tools: TOOLS, // ‚Üê –î–æ–±–∞–≤–ª—è–µ–º tools!
    messages: [{ role: 'user', content: message }]
  });
  
  return response;
}

// 2. –û–±–Ω–æ–≤–∏—Ç—å ai.routes.ts (+100 —Å—Ç—Ä–æ–∫)
router.post('/api/ai/chat', async (req, res) => {
  const { message } = req.body;
  const userId = req.user!.id;
  
  // –ü–æ–ª—É—á–∏—Ç—å API key
  const settings = await repositories.settings.findByUser(userId);
  const apiKey = settings?.anthropicApiKey;
  
  if (!apiKey) {
    return res.status(400).json({ 
      error: 'API key not configured' 
    });
  }
  
  // –í—ã–∑–≤–∞—Ç—å Claude —Å tools
  const response = await chatWithTools(
    message,
    apiKey,
    `You are a financial assistant. User ID: ${userId}`
  );
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–µ–Ω –ª–∏ tool
  const toolUse = response.content.find(c => c.type === 'tool_use');
  
  if (toolUse) {
    // –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    return res.json({
      type: 'tool_confirmation',
      action: toolUse.name,
      params: toolUse.input,
      toolUseId: toolUse.id
    });
  }
  
  // –û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç
  const textContent = response.content.find(c => c.type === 'text');
  return res.json({
    type: 'message',
    content: textContent.text
  });
});

// 3. –ù–æ–≤—ã–π endpoint –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
router.post('/api/ai/confirm-tool', async (req, res) => {
  const { action, params, toolUseId } = req.body;
  const userId = req.user!.id;
  
  // –í—ã–ø–æ–ª–Ω–∏—Ç—å tool
  const result = await executeTool(action, params, userId);
  
  if (!result.success) {
    return res.status(400).json({ error: result.error });
  }
  
  // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–ª–æ–≥
  const settings = await repositories.settings.findByUser(userId);
  const anthropic = new Anthropic({ 
    apiKey: settings!.anthropicApiKey 
  });
  
  const finalResponse = await anthropic.messages.create({
    model: 'claude-sonnet-4-5-20250929',
    max_tokens: 4096,
    messages: [
      ...previousMessages, // TODO: –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î
      {
        role: 'assistant',
        content: [{
          type: 'tool_use',
          id: toolUseId,
          name: action,
          input: params
        }]
      },
      {
        role: 'user',
        content: [{
          type: 'tool_result',
          tool_use_id: toolUseId,
          content: JSON.stringify(result.data)
        }]
      }
    ]
  });
  
  const textContent = finalResponse.content.find(c => c.type === 'text');
  return res.json({
    type: 'message',
    content: textContent.text
  });
});
```

### **–¢–µ—Å—Ç:**
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
curl -X POST /api/ai/chat \
  -d '{"message": "–ö–∞–∫–æ–π —É –º–µ–Ω—è –±–∞–ª–∞–Ω—Å?"}'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
{
  "type": "tool_confirmation",
  "action": "get_balance",
  "params": {}
}

# –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
curl -X POST /api/ai/confirm-tool \
  -d '{"action": "get_balance", "params": {}, "toolUseId": "..."}'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
{
  "type": "message",
  "content": "–¢–≤–æ–π –±–∞–ª–∞–Ω—Å: $10,000"
}
```

---

## üîß –®–ê–ì 6: –û–ë–ù–û–í–ò–¢–¨ FRONTEND (1 –î–ï–ù–¨)

### **–¶–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ AI Chat Sidebar

### **–§–∞–π–ª—ã (1 —Ñ–∞–π–ª, ~50 —Å—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–∏—Ç—å):**

```
client/src/components/ai-chat-sidebar/index.tsx
(–æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
```

### **–ó–∞–¥–∞—á–∞:**

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å index.tsx (+50 —Å—Ç—Ä–æ–∫)

const [pendingConfirmation, setPendingConfirmation] = useState<{
  action: string;
  params: Record<string, any>;
  toolUseId: string;
} | null>(null);

const sendMessage = async (text: string) => {
  // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  addMessage({ role: 'user', content: text });
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ API
  const response = await fetch('/api/ai/chat', {
    method: 'POST',
    body: JSON.stringify({ message: text })
  });
  
  const data = await response.json();
  
  if (data.type === 'tool_confirmation') {
    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    setPendingConfirmation({
      action: data.action,
      params: data.params,
      toolUseId: data.toolUseId
    });
  } else {
    // –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    addMessage({ role: 'assistant', content: data.content });
  }
};

const confirmTool = async () => {
  if (!pendingConfirmation) return;
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  const response = await fetch('/api/ai/confirm-tool', {
    method: 'POST',
    body: JSON.stringify(pendingConfirmation)
  });
  
  const data = await response.json();
  
  // –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç AI
  addMessage({ role: 'assistant', content: data.content });
  
  // –£–±—Ä–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
  setPendingConfirmation(null);
};

// –í JSX:
{pendingConfirmation && (
  <ConfirmationCard
    action={pendingConfirmation.action}
    params={pendingConfirmation.params}
    onConfirm={confirmTool}
    onCancel={() => setPendingConfirmation(null)}
  />
)}
```

### **–¢–µ—Å—Ç:**
```
1. –û—Ç–∫—Ä—ã—Ç—å AI Chat Sidebar
2. –ù–∞–ø–∏—Å–∞—Ç—å: "–ö–∞–∫–æ–π —É –º–µ–Ω—è –±–∞–ª–∞–Ω—Å?"
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
4. –ù–∞–∂–∞—Ç—å [‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å]
5. AI –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å —Å –±–∞–ª–∞–Ω—Å–æ–º
```

---

## üîß –®–ê–ì 7: –î–û–ë–ê–í–ò–¢–¨ –û–°–¢–ê–õ–¨–ù–´–ï TOOLS (1 –î–ï–ù–¨)

### **–¶–µ–ª—å:** –†–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### **–§–∞–π–ª—ã (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):**

```
server/ai/handlers/
‚îú‚îÄ goal-handler.ts
‚îú‚îÄ wallet-handler.ts
‚îî‚îÄ analytics-handler.ts
```

### **–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- create_goal
- create_wallet
- get_transactions
- search_transactions

---

## üîß –®–ê–ì 8: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –ü–û–õ–ò–†–û–í–ö–ê (1 –î–ï–ù–¨)

### **–ß–µ–∫–ª–∏—Å—Ç:**

```
‚úÖ –í—Å–µ tools —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
‚úÖ –û—Ç–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
‚úÖ UI –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π
‚úÖ –ù–µ—Ç memory leaks
‚úÖ LSP —á–∏—Å—Ç
‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã <200 —Å—Ç—Ä–æ–∫
```

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê

```
server/ai/
‚îú‚îÄ tool-types.ts (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ tools.ts (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ tool-executor.ts (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ chat-with-tools.ts (50 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ handlers/
   ‚îú‚îÄ index.ts (50 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ balance-handler.ts (50 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ category-handler.ts (50 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ transaction-handler.ts (50 —Å—Ç—Ä–æ–∫)
   ‚îú‚îÄ goal-handler.ts (50 —Å—Ç—Ä–æ–∫ - optional)
   ‚îî‚îÄ wallet-handler.ts (50 —Å—Ç—Ä–æ–∫ - optional)

client/src/components/ai-chat-sidebar/
‚îú‚îÄ index.tsx (–æ–±–Ω–æ–≤–ª—ë–Ω, +50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ confirmation-card.tsx (80 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ action-preview.tsx (50 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ confirmation-buttons.tsx (50 —Å—Ç—Ä–æ–∫)

–í–°–ï–ì–û: ~600 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
–§–ê–ô–õ–û–í: 13 —Ñ–∞–π–ª–æ–≤
–í–°–ï <200 –°–¢–†–û–ö! ‚úÖ
```

---

## üéØ –ü–û–†–Ø–î–û–ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

```
–î–ï–ù–¨ 1: –®–∞–≥–∏ 1-2 (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + –ø–µ—Ä–≤—ã–π tool)
–î–ï–ù–¨ 2: –®–∞–≥–∏ 3-4 (handlers + UI)
–î–ï–ù–¨ 3: –®–∞–≥ 5 (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ chat)
–î–ï–ù–¨ 4: –®–∞–≥ 6 (frontend)
–î–ï–ù–¨ 5: –®–∞–≥–∏ 7-8 (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ + —Ç–µ—Å—Ç—ã)

–ò–¢–û–ì–û: 5 –î–ù–ï–ô –ë–ï–ó–û–ü–ê–°–ù–û–ô –†–ê–ó–†–ê–ë–û–¢–ö–ò
```

---

**–ù–ê–ß–ò–ù–ê–ï–ú –° –®–ê–ì–ê 1?** üöÄ