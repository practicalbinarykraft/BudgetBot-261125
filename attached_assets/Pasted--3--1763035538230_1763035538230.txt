üè∑Ô∏è –¢–ó #3: –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –¢–ï–ì–ò (–î–ñ–£–ù-–§–†–ï–ù–î–õ–ò –í–ï–†–°–ò–Ø)

üéØ –ö–û–ù–¶–ï–ü–¶–ò–Ø –ü–†–û–°–¢–´–ú–ò –°–õ–û–í–ê–ú–ò
–ü—Ä–æ–±–ª–µ–º–∞: "–•–æ—á—É –ø–æ–Ω–∏–º–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞—á—É –Ω–∞ –¥–µ–≤—É—à–∫—É, –±—Ä–∞—Ç–∞, —Å–µ–±—è"
–†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ—Ç—å—é –æ—Å—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –ö–¢–û?
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç 3 —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

1. üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è      - –ß–¢–û –∫—É–ø–∏–ª? (–†–µ—Å—Ç–æ—Ä–∞–Ω—ã, –ü—Ä–æ–¥—É–∫—Ç—ã)
2. üéØ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç–∏–ø - –ó–ê–ß–ï–ú? (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
3. üë• –¢–µ–≥            - –ö–¢–û? (–Ø, –ú–∞—à–∞, –û–±—â–∏–µ, –î–∏–º–∞)
–ü—Ä–∏–º–µ—Ä—ã:
"–£–∂–∏–Ω —Å –ú–∞—à–µ–π 5000‚ÇΩ"
‚îú‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –†–µ—Å—Ç–æ—Ä–∞–Ω—ã
‚îú‚îÄ –¢–∏–ø: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
‚îî‚îÄ –¢–µ–≥: üè† –û–±—â–∏–µ (–æ–±–∞ –µ–ª–∏)

"–ú–∞—Å—Å–∞–∂ –¥–ª—è –ú–∞—à–∏ 2000‚ÇΩ"
‚îú‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ó–¥–æ—Ä–æ–≤—å–µ
‚îú‚îÄ –¢–∏–ø: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
‚îî‚îÄ –¢–µ–≥: üíù –ú–∞—à–∞ (—Ç–æ–ª—å–∫–æ –æ–Ω–∞)

"–ò–≥—Ä–∞ –Ω–∞ –ü–ö 500‚ÇΩ"
‚îú‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
‚îú‚îÄ –¢–∏–ø: –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
‚îî‚îÄ –¢–µ–≥: üë§ –õ–∏—á–Ω—ã–µ (—Ç–æ–ª—å–∫–æ —è)

üìÅ –°–¢–†–£–ö–¢–£–†–ê (–ú–û–î–£–õ–¨–ù–ê–Ø!)
client/src/
  components/
    tags/                           ‚Üê –ù–æ–≤–∞—è –ø–∞–ø–∫–∞ –¥–ª—è —Ç–µ–≥–æ–≤
      ‚îú‚îÄ tag-badge.tsx              (20 —Å—Ç—Ä–æ–∫ - –∏–∫–æ–Ω–∫–∞)
      ‚îú‚îÄ tag-selector.tsx           (50 —Å—Ç—Ä–æ–∫ - dropdown)
      ‚îú‚îÄ tag-card.tsx               (80 —Å—Ç—Ä–æ–∫ - –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–µ–≥–∞)
      ‚îú‚îÄ create-tag-dialog.tsx      (100 —Å—Ç—Ä–æ–∫ - —Å–æ–∑–¥–∞—Ç—å —Ç–µ–≥)
      ‚îî‚îÄ spending-by-person.tsx     (120 —Å—Ç—Ä–æ–∫ - Dashboard –∫–∞—Ä—Ç–æ—á–∫–∞)
  
  pages/
    ‚îî‚îÄ tags-settings-page.tsx       (–Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, 150 —Å—Ç—Ä–æ–∫)

server/
  routes/
    ‚îî‚îÄ personal-tags.routes.ts      (–Ω–æ–≤—ã–π —Ñ–∞–π–ª, 120 —Å—Ç—Ä–æ–∫)
  
  services/
    ‚îî‚îÄ tag.service.ts               (–Ω–æ–≤—ã–π —Ñ–∞–π–ª, 80 —Å—Ç—Ä–æ–∫)

shared/
  ‚îî‚îÄ schema.ts                      (–¥–æ–±–∞–≤–∏—Ç—å 1 —Ç–∞–±–ª–∏—Ü—É)
–í–°–ï –§–ê–ô–õ–´ < 200 –°–¢–†–û–ö! ‚úÖ

–§–ê–ó–ê 1: –ë–ê–ó–ê –î–ê–ù–ù–´–• (15 –º–∏–Ω—É—Ç)
–§–∞–π–ª: shared/schema.ts
–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É:
typescript/**
 * –¢–µ–≥–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –ª—é–¥—è–º
 * –ü—Ä–∏–º–µ—Ä—ã: "–ú–∞—à–∞", "–î–∏–º–∞", "–õ–∏—á–Ω—ã–µ", "–û–±—â–∏–µ"
 */
export const personalTags = pgTable("personal_tags", {
  id: serial("id").primaryKey(),
  
  userId: integer("user_id")
    .references(() => users.id, { onDelete: "cascade" })
    .notNull(),
  
  name: text("name").notNull(),         // "–ú–∞—à–∞", "–î–∏–º–∞"
  icon: text("icon").default("üë§"),    // –≠–º–æ–¥–∑–∏
  color: text("color").default("#3b82f6"),
  
  // –¢–∏–ø —Ç–µ–≥–∞
  type: text("type").notNull().default("person"),
  // 'personal' = —è
  // 'shared' = –æ–±—â–∏–µ
  // 'person' = –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫
  
  // –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–µ–≥–∏
  isDefault: boolean("is_default").default(false),
  
  sortOrder: integer("sort_order").default(0),
  createdAt: timestamp("created_at").defaultNow()
});
–û–±–Ω–æ–≤–∏—Ç—å transactions:
typescriptexport const transactions = pgTable("transactions", {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
  
  // ‚úÖ –ù–û–í–û–ï: –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–≥
  personalTagId: integer("personal_tag_id")
    .references(() => personalTags.id, { onDelete: "set null" }),
});
–†–∞–∑–º–µ—Ä: +30 —Å—Ç—Ä–æ–∫

–§–ê–ó–ê 2: BACKEND (1.5 —á–∞—Å–∞)
1. –°–æ–∑–¥–∞—Ç—å Routes (120 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: server/routes/personal-tags.routes.ts
typescriptimport { Router } from 'express';
import { requireAuth } from '../middleware/auth';
import * as tagService from '../services/tag.service';

const router = Router();

/**
 * GET /api/tags
 * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
router.get('/', requireAuth, async (req, res) => {
  const userId = req.user!.id;
  
  try {
    const tags = await tagService.getAllTags(userId);
    res.json(tags);
  } catch (error) {
    res.status(500).json({ error: 'Failed to load tags' });
  }
});

/**
 * POST /api/tags
 * –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥
 */
router.post('/', requireAuth, async (req, res) => {
  const userId = req.user!.id;
  const { name, icon, color, type } = req.body;
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (!name || name.length < 1) {
    return res.status(400).json({ error: 'Name is required' });
  }
  
  try {
    const tag = await tagService.createTag(userId, {
      name,
      icon: icon || 'üë§',
      color: color || '#3b82f6',
      type: type || 'person'
    });
    
    res.json(tag);
  } catch (error) {
    res.status(500).json({ error: 'Failed to create tag' });
  }
});

/**
 * PATCH /api/tags/:id
 * –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–≥
 */
router.patch('/:id', requireAuth, async (req, res) => {
  const tagId = parseInt(req.params.id);
  const { name, icon, color } = req.body;
  
  try {
    const tag = await tagService.updateTag(tagId, {
      name,
      icon,
      color
    });
    
    res.json(tag);
  } catch (error) {
    res.status(500).json({ error: 'Failed to update tag' });
  }
});

/**
 * DELETE /api/tags/:id
 * –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥
 */
router.delete('/:id', requireAuth, async (req, res) => {
  const tagId = parseInt(req.params.id);
  
  try {
    // –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ–≥–∏
    const tag = await tagService.getTag(tagId);
    
    if (tag.isDefault) {
      return res.status(400).json({ 
        error: 'Cannot delete default tag' 
      });
    }
    
    await tagService.deleteTag(tagId);
    res.json({ success: true });
  } catch (error) {
    res.status(500).json({ error: 'Failed to delete tag' });
  }
});

/**
 * GET /api/tags/:id/stats
 * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–≥—É
 */
router.get('/:id/stats', requireAuth, async (req, res) => {
  const tagId = parseInt(req.params.id);
  
  try {
    const stats = await tagService.getTagStats(tagId);
    res.json(stats);
  } catch (error) {
    res.status(500).json({ error: 'Failed to load stats' });
  }
});

export default router;
–†–∞–∑–º–µ—Ä: 120 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: 5 endpoints (GET, POST, PATCH, DELETE, GET stats)

2. –°–æ–∑–¥–∞—Ç—å Service (80 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: server/services/tag.service.ts
typescriptimport { db } from '../db';
import { personalTags, transactions } from '@shared/schema';
import { eq, and, sql } from 'drizzle-orm';

/**
 * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export async function getAllTags(userId: number) {
  return await db
    .select()
    .from(personalTags)
    .where(eq(personalTags.userId, userId))
    .orderBy(personalTags.sortOrder);
}

/**
 * –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥
 */
export async function createTag(
  userId: number,
  data: { name: string; icon: string; color: string; type: string }
) {
  const [tag] = await db
    .insert(personalTags)
    .values({
      userId,
      name: data.name,
      icon: data.icon,
      color: data.color,
      type: data.type,
      isDefault: false,
    })
    .returning();
  
  return tag;
}

/**
 * –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–≥
 */
export async function updateTag(
  tagId: number,
  data: { name?: string; icon?: string; color?: string }
) {
  const [tag] = await db
    .update(personalTags)
    .set(data)
    .where(eq(personalTags.id, tagId))
    .returning();
  
  return tag;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç–µ–≥
 */
export async function getTag(tagId: number) {
  const [tag] = await db
    .select()
    .from(personalTags)
    .where(eq(personalTags.id, tagId))
    .limit(1);
  
  return tag;
}

/**
 * –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥
 */
export async function deleteTag(tagId: number) {
  // –°–Ω–∞—á–∞–ª–∞ —É–±—Ä–∞—Ç—å —Ç–µ–≥ —É –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  await db
    .update(transactions)
    .set({ personalTagId: null })
    .where(eq(transactions.personalTagId, tagId));
  
  // –ü–æ—Ç–æ–º —É–¥–∞–ª–∏—Ç—å —Ç–µ–≥
  await db
    .delete(personalTags)
    .where(eq(personalTags.id, tagId));
}

/**
 * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–≥—É
 */
export async function getTagStats(tagId: number) {
  const result = await db
    .select({
      count: sql<number>`count(*)`,
      total: sql<number>`sum(${transactions.amountUsd})`
    })
    .from(transactions)
    .where(eq(transactions.personalTagId, tagId));
  
  return {
    transactionCount: result[0].count || 0,
    totalSpent: result[0].total || 0
  };
}

/**
 * –°–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ–≥–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 */
export async function createDefaultTags(userId: number) {
  await db.insert(personalTags).values([
    {
      userId,
      name: 'Personal (Me)',
      icon: 'üë§',
      color: '#3b82f6',
      type: 'personal',
      isDefault: true,
      sortOrder: 1
    },
    {
      userId,
      name: 'Shared',
      icon: 'üè†',
      color: '#8b5cf6',
      type: 'shared',
      isDefault: true,
      sortOrder: 2
    }
  ]);
}
–†–∞–∑–º–µ—Ä: 80 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: 7 —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–≥–∞–º–∏

3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å routes
–§–∞–π–ª: server/index.ts
–ù–∞–π–¥–∏: –º–µ—Å—Ç–æ –≥–¥–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è routes
–î–æ–±–∞–≤—å:
typescriptimport personalTagsRoutes from './routes/personal-tags.routes';

// ...

app.use('/api/tags', personalTagsRoutes);
–†–∞–∑–º–µ—Ä: +2 —Å—Ç—Ä–æ–∫–∏

–§–ê–ó–ê 3: FRONTEND (3 —á–∞—Å–∞)
1. Badge –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (20 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/components/tags/tag-badge.tsx
typescript/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∫–æ–Ω–∫—É –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞
 */
interface TagBadgeProps {
  tag: {
    icon: string;
    name: string;
    color: string;
  };
}

export function TagBadge({ tag }: TagBadgeProps) {
  return (
    <span 
      className="flex items-center gap-1"
      style={{ color: tag.color }}
    >
      <span>{tag.icon}</span>
      <span>{tag.name}</span>
    </span>
  );
}
–†–∞–∑–º–µ—Ä: 20 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–≥ (–∏–∫–æ–Ω–∫–∞ + –∏–º—è)

2. Selector –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (50 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/components/tags/tag-selector.tsx
typescriptimport { Select, SelectTrigger, SelectContent, SelectItem } from '@/components/ui/select';
import { TagBadge } from './tag-badge';
import { useQuery } from '@tanstack/react-query';

/**
 * Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–≥–∞
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
 */
interface TagSelectorProps {
  value: number | null;
  onChange: (tagId: number) => void;
}

export function TagSelector({ value, onChange }: TagSelectorProps) {
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const { data: tags = [] } = useQuery({
    queryKey: ['/api/tags'],
  });
  
  // –ù–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–µ–≥
  const selectedTag = tags.find(t => t.id === value);
  
  return (
    <Select 
      value={value?.toString()} 
      onValueChange={(v) => onChange(parseInt(v))}
    >
      <SelectTrigger>
        {selectedTag ? (
          <TagBadge tag={selectedTag} />
        ) : (
          <span className="text-muted-foreground">
            Select tag...
          </span>
        )}
      </SelectTrigger>
      
      <SelectContent>
        {tags.map(tag => (
          <SelectItem key={tag.id} value={tag.id.toString()}>
            <TagBadge tag={tag} />
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
–†–∞–∑–º–µ—Ä: 50 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: Dropdown —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–µ–≥–æ–≤

3. Tag Card –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (80 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/components/tags/tag-card.tsx
typescriptimport { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { TagBadge } from './tag-badge';
import { Edit, Trash2 } from 'lucide-react';

/**
 * –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–µ–≥–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ Edit/Delete
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Settings
 */
interface TagCardProps {
  tag: {
    id: number;
    name: string;
    icon: string;
    color: string;
    isDefault: boolean;
  };
  stats: {
    transactionCount: number;
    totalSpent: number;
  };
  onEdit: () => void;
  onDelete: () => void;
}

export function TagCard({ tag, stats, onEdit, onDelete }: TagCardProps) {
  return (
    <Card className="p-4">
      <div className="flex items-center justify-between">
        {/* Left side: Badge + stats */}
        <div className="flex items-center gap-4">
          <TagBadge tag={tag} />
          
          <div className="text-sm text-muted-foreground">
            {stats.transactionCount} transactions
            {' ¬∑ '}
            ${stats.totalSpent.toFixed(2)}
          </div>
        </div>
        
        {/* Right side: Buttons */}
        <div className="flex gap-2">
          <Button size="sm" variant="ghost" onClick={onEdit}>
            <Edit className="w-4 h-4" />
          </Button>
          
          {/* –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ–≥–∏ */}
          {!tag.isDefault && (
            <Button size="sm" variant="ghost" onClick={onDelete}>
              <Trash2 className="w-4 h-4" />
            </Button>
          )}
        </div>
      </div>
    </Card>
  );
}
–†–∞–∑–º–µ—Ä: 80 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∏–Ω—Ñ–æ –æ —Ç–µ–≥–µ + –∫–Ω–æ–ø–∫–∏

4. Create Tag Dialog (100 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/components/tags/create-tag-dialog.tsx
typescriptimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { useState } from 'react';

/**
 * –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞
 */
interface CreateTagDialogProps {
  open: boolean;
  onClose: () => void;
  onSave: (data: { name: string; icon: string; color: string }) => void;
}

export function CreateTagDialog({ open, onClose, onSave }: CreateTagDialogProps) {
  const [name, setName] = useState('');
  const [icon, setIcon] = useState('üë§');
  const [color, setColor] = useState('#3b82f6');
  
  const handleSave = () => {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!name.trim()) {
      alert('Name is required');
      return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    onSave({ name, icon, color });
    
    // –ó–∞–∫—Ä—ã—Ç—å –∏ –æ—á–∏—Å—Ç–∏—Ç—å
    onClose();
    setName('');
    setIcon('üë§');
    setColor('#3b82f6');
  };
  
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Create New Tag</DialogTitle>
        </DialogHeader>
        
        <div className="space-y-4">
          {/* Name input */}
          <div>
            <label className="text-sm font-medium">Name</label>
            <Input 
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Masha, Dima, Family..."
            />
          </div>
          
          {/* Icon input */}
          <div>
            <label className="text-sm font-medium">Icon (emoji)</label>
            <Input 
              value={icon}
              onChange={(e) => setIcon(e.target.value)}
              maxLength={2}
              placeholder="üë§"
            />
          </div>
          
          {/* Color input */}
          <div>
            <label className="text-sm font-medium">Color</label>
            <input 
              type="color"
              value={color}
              onChange={(e) => setColor(e.target.value)}
              className="w-full h-10 rounded border"
            />
          </div>
          
          {/* Buttons */}
          <div className="flex gap-2 justify-end">
            <Button variant="outline" onClick={onClose}>
              Cancel
            </Button>
            <Button onClick={handleSave}>
              Save
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
}
–†–∞–∑–º–µ—Ä: 100 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞ (3 –ø–æ–ª—è)

5. Settings Page (150 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/pages/tags-settings-page.tsx
typescriptimport { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import { TagCard } from '@/components/tags/tag-card';
import { CreateTagDialog } from '@/components/tags/create-tag-dialog';
import { Plus } from 'lucide-react';

/**
 * –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏ –≤ Settings
 */
export function TagsSettingsPage() {
  const [dialogOpen, setDialogOpen] = useState(false);
  const queryClient = useQueryClient();
  
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–≥–∏
  const { data: tags = [] } = useQuery({
    queryKey: ['/api/tags'],
  });
  
  // –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥
  const createMutation = useMutation({
    mutationFn: async (data: any) => {
      const res = await fetch('/api/tags', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      return res.json();
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/tags'] });
    }
  });
  
  // –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥
  const deleteMutation = useMutation({
    mutationFn: async (tagId: number) => {
      await fetch(`/api/tags/${tagId}`, { method: 'DELETE' });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/tags'] });
    }
  });
  
  const handleSave = (data: any) => {
    createMutation.mutate(data);
  };
  
  const handleDelete = (tagId: number) => {
    if (confirm('Delete this tag?')) {
      deleteMutation.mutate(tagId);
    }
  };
  
  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Personal Tags</h1>
          <p className="text-muted-foreground">
            Group your expenses by people
          </p>
        </div>
        
        <Button onClick={() => setDialogOpen(true)}>
          <Plus className="w-4 h-4 mr-2" />
          Create Tag
        </Button>
      </div>
      
      {/* List of tags */}
      <div className="space-y-3">
        {tags.map(tag => (
          <TagCard
            key={tag.id}
            tag={tag}
            stats={{
              transactionCount: 0, // TODO: –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ API
              totalSpent: 0
            }}
            onEdit={() => {
              // TODO: –æ—Ç–∫—Ä—ã—Ç—å edit dialog
            }}
            onDelete={() => handleDelete(tag.id)}
          />
        ))}
      </div>
      
      {/* Create dialog */}
      <CreateTagDialog
        open={dialogOpen}
        onClose={() => setDialogOpen(false)}
        onSave={handleSave}
      />
    </div>
  );
}
–†–∞–∑–º–µ—Ä: 150 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–µ–≥–æ–≤ + CRUD

6. Dashboard Card (120 —Å—Ç—Ä–æ–∫)
–ù–æ–≤—ã–π —Ñ–∞–π–ª: client/src/components/tags/spending-by-person.tsx
typescriptimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { TagBadge } from './tag-badge';
import { useQuery } from '@tanstack/react-query';

/**
 * –ö–∞—Ä—Ç–æ—á–∫–∞ "Spending by Person" –Ω–∞ Dashboard
 */
export function SpendingByPersonCard() {
  // TODO: –°–æ–∑–¥–∞—Ç—å endpoint /api/analytics/by-tags
  const { data } = useQuery({
    queryKey: ['/api/analytics/by-tags'],
  });
  
  if (!data) {
    return (
      <Card>
        <CardContent className="p-6">
          <p className="text-muted-foreground">Loading...</p>
        </CardContent>
      </Card>
    );
  }
  
  const total = data.reduce((sum, item) => sum + item.amount, 0);
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>üë• Spending by Person</CardTitle>
        <p className="text-sm text-muted-foreground">
          This Month: ${total.toFixed(2)}
        </p>
      </CardHeader>
      
      <CardContent className="space-y-4">
        {data.map(({ tag, amount, topCategories }) => {
          const percent = Math.round((amount / total) * 100);
          
          return (
            <div key={tag.id} className="space-y-2">
              {/* Header */}
              <div className="flex items-center justify-between">
                <TagBadge tag={tag} />
                <span className="text-sm">
                  ${amount.toFixed(2)} ({percent}%)
                </span>
              </div>
              
              {/* Progress bar */}
              <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className="h-full rounded-full"
                  style={{
                    width: `${percent}%`,
                    backgroundColor: tag.color
                  }}
                />
              </div>
              
              {/* Top categories */}
              <div className="text-xs text-muted-foreground">
                {topCategories.map(cat => (
                  <span key={cat}>‚Ä¢ {cat} </span>
                ))}
              </div>
            </div>
          );
        })}
      </CardContent>
    </Card>
  );
}
–†–∞–∑–º–µ—Ä: 120 —Å—Ç—Ä–æ–∫ ‚úÖ
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–∞—Ç—ã –ø–æ –ª—é–¥—è–º

7. –û–±–Ω–æ–≤–∏—Ç—å Transaction Form (+15 —Å—Ç—Ä–æ–∫)
–§–∞–π–ª: client/src/components/transaction-form.tsx
–ù–∞–π–¥–∏: –§–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
–î–æ–±–∞–≤—å –ø–æ—Å–ª–µ category –∏ financialType:
typescriptimport { TagSelector } from '@/components/tags/tag-selector';

// –í —Ñ–æ—Ä–º–µ:
<div>
  <label>Personal Tag</label>
  <TagSelector 
    value={form.personalTagId}
    onChange={(tagId) => form.setPersonalTagId(tagId)}
  />
</div>
```

**–†–∞–∑–º–µ—Ä:** +15 —Å—Ç—Ä–æ–∫

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```
1. –û—Ç–∫—Ä—ã—Ç—å Settings ‚Üí Personal Tags
2. –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥ "Masha" (–∏–∫–æ–Ω–∫–∞ üíù, —Ü–≤–µ—Ç —Ä–æ–∑–æ–≤—ã–π)
3. –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é "–£–∂–∏–Ω —Å –ú–∞—à–µ–π 5000‚ÇΩ"
4. –í—ã–±—Ä–∞—Ç—å —Ç–µ–≥ "Masha"
5. –û—Ç–∫—Ä—ã—Ç—å Dashboard
6. –í–∏–¥–µ—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É "Spending by Person"
7. –í–∏–¥–µ—Ç—å: "üíù Masha - $5000"
```

---

## üí° –ü–û–ß–ï–ú–£ –≠–¢–û –•–û–†–û–®–û –î–õ–Ø –î–ñ–£–ù–ê?
```
‚úÖ 7 —Ñ–∞–π–ª–æ–≤, –≤—Å–µ < 200 —Å—Ç—Ä–æ–∫
‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞:
   - tag-badge.tsx = –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–≥
   - tag-selector.tsx = dropdown
   - tag-card.tsx = –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏
   - create-tag-dialog.tsx = —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - tags-settings-page.tsx = —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - spending-by-person.tsx = Dashboard –∫–∞—Ä—Ç–æ—á–∫–∞
   - personal-tags.routes.ts = API endpoints
   - tag.service.ts = –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å DB

‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≥–¥–µ –Ω—É–∂–Ω–æ
‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ —á—Ç–æ –ø—Ä–∞–≤–∏—Ç—å:
   - –ò–∫–æ–Ω–∫–∞? ‚Üí tag-badge.tsx
   - Dropdown? ‚Üí tag-selector.tsx
   - –§–æ—Ä–º–∞? ‚Üí create-tag-dialog.tsx
   - API? ‚Üí personal-tags.routes.ts
```

---

## üöÄ –†–ê–ó–ú–ï–† –ò–ó–ú–ï–ù–ï–ù–ò–ô
```
–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: 9
–ò–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤: 2
–°—Ç—Ä–æ–∫: ~700
–°–ª–æ–∂–Ω–æ—Å—Ç—å: –°—Ä–µ–¥–Ω—è—è
–í—Ä–µ–º—è: 5-6 —á–∞—Å–æ–≤

üìã –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø REPLIT
markdown# üè∑Ô∏è –ß–µ–∫–ª–∏—Å—Ç: Personal Tags

## Backend (1.5 —á–∞—Å–∞):
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É personal_tags –≤ schema.ts (+15 —Å—Ç—Ä–æ–∫)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ personalTagId –≤ transactions (+3 —Å—Ç—Ä–æ–∫–∏)
- [ ] –°–æ–∑–¥–∞—Ç—å personal-tags.routes.ts (120 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å tag.service.ts (80 —Å—Ç—Ä–æ–∫)
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å routes –≤ index.ts (+2 —Å—Ç—Ä–æ–∫–∏)

## Frontend (3 —á–∞—Å–∞):
- [ ] –°–æ–∑–¥–∞—Ç—å tag-badge.tsx (20 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å tag-selector.tsx (50 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å tag-card.tsx (80 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å create-tag-dialog.tsx (100 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å tags-settings-page.tsx (150 —Å—Ç—Ä–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å spending-by-person.tsx (120 —Å—Ç—Ä–æ–∫)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å transaction-form.tsx (+15 —Å—Ç—Ä–æ–∫)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Ç–µ–≥–∏
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å —Ç–µ–≥–æ–º
- [ ] Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–∞—Ç—ã –ø–æ –ª—é–¥—è–º